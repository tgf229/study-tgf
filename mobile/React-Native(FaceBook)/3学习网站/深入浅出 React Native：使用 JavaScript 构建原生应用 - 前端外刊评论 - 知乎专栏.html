<!DOCTYPE html>
<!-- saved from url=(0051)http://zhuanlan.zhihu.com/FrontendMagazine/19996445 -->
<html class="no-touch"><!--<![endif]--><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><style type="text/css">@charset "UTF-8";[ng\:cloak],[ng-cloak],[data-ng-cloak],[x-ng-cloak],.ng-cloak,.x-ng-cloak,.ng-hide{display:none !important;}ng\:form{display:block;}.ng-animate-block-transitions{transition:0s all!important;-webkit-transition:0s all!important;}.ng-hide-add-active,.ng-hide-remove{display:block!important;}</style>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>深入浅出 React Native：使用 JavaScript 构建原生应用 - 前端外刊评论 - 知乎专栏</title>
    <!--<base href="/">--><base href=".">
    <meta name="fragment" content="!">
    <meta name="description" content="知乎专栏">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <!--[if lt IE 9]>
      <script src="http://z1.zhimg.com/components/es5-shim/es5-shim.js"></script>
      <script src="http://z1.zhimg.com/components/html5shiv/dist/html5shiv.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
      <script src="http://z1.zhimg.com/components/json3/lib/json3.min.js"></script>
    <![endif]-->
    <script src="./深入浅出 React Native：使用 JavaScript 构建原生应用 - 前端外刊评论 - 知乎专栏_files/ga.js" async=""></script><script>document.documentElement.className += ('ontouchstart' in window) ? ' touch' : ' no-touch'</script>
    <link rel="stylesheet" href="http://z1.zhimg.com/styles/4feaac5d.main.css">
  </head>
  <body ng-app="columnWebApp" ng-controller="AppCtrl" ng-class="pageClass" class="ng-scope">
    <!--[if lt IE 8]>
    <p class="browsehappy">
      你正在使用一个<strong>过时</strong>的浏览器。请<a class="link" href="http://browsehappy.com">升级你的浏览器</a>以查看此页面。</p>
    </p>
    <![endif]-->

    <div id="header-holder">
        <!-- ngInclude: navbarTemplateUrl --><div ng-include="navbarTemplateUrl" class="ng-scope">
<header id="header" class="navbar ng-scope" ng-controller="NavbarCtrl">
  <div class="receptacle">

    <div class="navbar-logo-container">
      <a href="http://www.zhihu.com/" target="_blank" class="logo icon icon-navbar-logo"></a>
    </div>

    <!-- ngIf: !me.authed() && me.$resolved -->

    <!-- ngIf: me.authed() && !me.beta --><div ng-transclude="" class="navbar-menu-container ui-menu-button ng-scope" ng-class="{ true: &#39;open&#39;, false: &#39;close&#39; }[open]" ui-menu-button="" ng-if="me.authed() &amp;&amp; !me.beta">
      <a href="javascript:;" class="menu-button ng-scope">
        <i class="icon icon-navbar-menu"></i><span class="hide-text">菜单</span>
      </a>
      <menu class="menu navbar-menu ng-scope" tabindex="0">
        <a class="menu-item dd-logout" href="http://www.zhihu.com/logout" tabindex="0">
          <i class="icon icon-dd-logout"></i>退出帐号</a>
      </menu>
    </div><!-- end ngIf: me.authed() && !me.beta -->

    <!-- ngIf: me.beta -->

    <!-- ngIf: me.beta -->

    <!-- ngIf: me.beta -->

    <div class="navbar-content">
      <ul class="breadcrumb clearfix">
        <!-- ngIf: column && column.name && !columnSelectOnly --><li class="breadcrumb-item column-name ng-scope" ng-if="column &amp;&amp; column.name &amp;&amp; !columnSelectOnly">
          <a class="link" href="http://zhuanlan.zhihu.com/FrontendMagazine">
            <!-- ngIf: me.slug != column.creator.slug --><button ng-click="toggleFollow(column, $event)" class="btn normal ng-binding ng-scope btn-dark-green" ng-class="{ true: &#39;btn-grey&#39;, false: &#39;btn-dark-green&#39; }[column.following]" ng-if="me.slug != column.creator.slug">关注专栏</button><!-- end ngIf: me.slug != column.creator.slug -->
            <span class="name ng-binding" title="前端外刊评论">前端外刊评论</span>
          </a>
        </li><!-- end ngIf: column && column.name && !columnSelectOnly -->
        <!-- ngIf: columnSelectOnly -->
        <!-- ngIf: column && pageTitle || columnSelectOnly -->
        <li class="breadcrumb-item">
          <span class="name ng-binding" ng-bind="pageTitle"></span>
        </li>
      </ul>
    </div>

  </div>
</header>
</div>
    </div>

    <div class="ui-alertbar info ng-hide" ng-show="alert.message" data-alert="globalAlert" data-align="bottom" data-target="#header-holder" ui-alertbar="" ui-sticky="">
  <div class="receptacle ng-binding">
    <i class="icon icon-alertbar-info"></i>
    
  </div>
</div>

    <!-- Add your site or application content here -->
    <!-- ngView:  --><main class="main-container ng-scope" ng-view="">
<div class="main receptacle post-view ng-scope">

  <article class="entry ng-scope" ng-controller="EntryCtrl" ui-lightbox="">
    <header>
      <!-- ngIf: post.titleImage --><div class="entry-title-image ng-scope" ng-if="post.titleImage">
        <!-- <span class="img-captions">我的摄影作品</span> -->
        <img ng-src="http://pic3.zhimg.com/93517997175c5a1ff5b78ec226ce5edd_b.jpg" src="./深入浅出 React Native：使用 JavaScript 构建原生应用 - 前端外刊评论 - 知乎专栏_files/93517997175c5a1ff5b78ec226ce5edd_b.jpg">
      </div><!-- end ngIf: post.titleImage -->

      <!-- ngIf: post.sourceUrl -->

      <h1 class="entry-title ng-binding">深入浅出 React Native：使用 JavaScript 构建原生应用</h1>

      <div class="entry-meta">
        <a target="_blank" href="http://www.zhihu.com/people/kmokidd" class="author name ng-binding">
          <img ng-src="http://pic2.zhimg.com/1b379db3fc9d491be4df815e058bd3a1_s.jpg" alt="" class="avatar-small" src="./深入浅出 React Native：使用 JavaScript 构建原生应用 - 前端外刊评论 - 知乎专栏_files/1b379db3fc9d491be4df815e058bd3a1_s.jpg">kmokidd</a>
        <span class="bull">·</span>
        <time title="2015年4月7日星期二晚上7点23分" ui-time="" datetime="2015-04-07T19:23:29+08:00" class="published ng-binding ng-isolate-scope">2 个月前</time>
      </div>
    </header>

    <!-- ngIf: isCensoring -->

    <section class="entry-content ng-binding" ng-bind-html="postContentTrustedHtml"><blockquote><p>本篇为联合翻译，译者：<a href="http://www.zhihu.com/people/stein.cun" class="internal">寸志</a>，<a href="http://www.zhihu.com/people/fan-hong-chun" class="internal">范洪春</a>，<a href="http://www.zhihu.com/people/kmokidd" class="internal">kmokidd</a>，<a href="http://www.zhihu.com/people/jiang-tian-yi" class="internal">姜天意</a>，感谢帮忙校对的<a href="http://www.zhihu.com/people/xu-jia-yi" class="internal">徐嘉轶</a></p></blockquote><br><p>数月前，<a href="https://code.facebook.com/videos/786462671439502/react-js-conf-2015-keynote-introducing-react-native-/" class=" wrap external" target="_blank" rel="nofollow noreferrer">Facebook 对外宣布了正在开发的 React Native 框架<i class="icon-external"></i></a>，这个框架允许你使用 JavaScript 开发原生的 iOS 应用——就在今天，<a href="https://github.com/facebook/react-native" class=" wrap external" target="_blank" rel="nofollow noreferrer">Beta 版的仓库<i class="icon-external"></i></a>释出了！</p><p>基于 <a href="http://phonegap.com/" class=" wrap external" target="_blank" rel="nofollow noreferrer">PhoneGap<i class="icon-external"></i></a> 使用 JavaScript 和 HTML5 开发 iOS 应用已经有好几年了，那 React Native 有什么牛的？</p><p>React Native 真的很牛，让大家兴奋异常的主要原因有两点：</p><ol><li><p>可以基于 React Native使用 JavaScript 编写应用逻辑，UI 则可以保持全是原生的。这样的话就没有必要就 HTML5 的 UI 做出常见的妥协；</p></li><li><p>React 引入了一种与众不同的、略显激进但具备高可用性的方案来构建用户界面。长话短说，应用的 UI 简单通过一个基于应用目前状态的函数来表达。</p></li></ol><p>React Native 的关键就是，以把 <a href="http://facebook.github.io/react/" class=" wrap external" target="_blank" rel="nofollow noreferrer">React<i class="icon-external"></i></a> 编程模式的能力带到移动开发来作为主要目标。它的目标不是跨平台一次编写到处执行，而是一次学习跨平台开发。这个是一个非常大的区别。这篇教程只介绍 iOS 平台，不过你一旦掌握了相关的概念，就可以应用到 Android 平台，快速构建 Android 应用。</p><p>如果之前只用过 Objective-C 或者 Swift 写应用的话，你很可能不会对使用 JavaScript 来编写应用的愿景感到兴奋。尽管如此，作为一个 Swift 开发者来说，上面提到的第二点应该可以激起你的兴趣！</p><p>你通过 Swift，毫无疑问学习到了新的更多有效的编码方法和技巧，鼓励转换和不变性。然而，构建 UI 的方式还是和使用 Objective-C 的方式一致。仍然以 UIKit 为基础，独断专横。</p><p>通过像 virtual DOM 和 reconciliation 这些有趣的概念，React 将函数式编程直接带到了 UI 层。</p><p>这篇教程将带着你一路构建一个 UK 房产搜索应用：</p><img src="./深入浅出 React Native：使用 JavaScript 构建原生应用 - 前端外刊评论 - 知乎专栏_files/062e83eb739070f18971e3d7a3f473ff_b.jpg" data-rawwidth="700" data-rawheight="360" class="origin_image zh-lightbox-thumb" width="700" data-original="http://pic2.zhimg.com/062e83eb739070f18971e3d7a3f473ff_r.jpg"><p>如果你之前一点 JavaScript 都没写过，别担心。这篇教程带着你进行一步一步进行编码。React 使用 CSS 属性来定义样式，一般比较容易读也比较容易理解。但是如果你想了解更多的话，可以去看看 <a href="https://developer.mozilla.org/en-US/docs/Web/CSS" class=" wrap external" target="_blank" rel="nofollow noreferrer">Mozilla Developer Network reference<i class="icon-external"></i></a>，很不错的。</p><p>想要学习更多，继续往下读！</p><br><h2>准备工作</h2><p>React Native 框架<a href="https://github.com/facebook/react-native" class=" wrap external" target="_blank" rel="nofollow noreferrer">托管在 GitHub 上<i class="icon-external"></i></a>。你可以通过两种方式获取到它：使用 git 克隆仓库，或者下载一个 zip 压缩包文件。如果你的机器上已经安装了 React Native，在着手编码前还有其他几个因素需要考虑。</p><ul><li>React Native 借助 <a href="https://nodejs.org/" class=" wrap external" target="_blank" rel="nofollow noreferrer">Node.js<i class="icon-external"></i></a>，即 JavaScript 运行时来创建 JavaScript 代码。如果你已经安装了 Node.js，那就可以上手了。</li></ul><p>首先，使用 Homebrew 官网提供的指引<a href="http://brew.sh/" class=" wrap external" target="_blank" rel="nofollow noreferrer">安装 Homebrew<i class="icon-external"></i></a>，然后在终端执行以下命令：</p><div class="highlight"><pre><code class="language-js"><span class="nx">brew</span> <span class="nx">install</span> <span class="nx">node</span>
</code></pre></div><p>接下来，使用 homebrew 安装 <a href="https://facebook.github.io/watchman/" class=" wrap external" target="_blank" rel="nofollow noreferrer">watchman<i class="icon-external"></i></a>，一个来自Facebook 的观察程序：</p><div class="highlight"><pre><code class="language-text">brew install watchman
</code></pre></div><p>通过配置 watchman，React 实现了在代码发生变化时，完成相关的重建的功能。就像在使用 Xcode 时，每次保存文件都会进行一次创建。</p><p> 接下来使用 `npm` 安装 React Native CLI 工具：<br></p><div class="highlight"><pre><code class="language-js"><span class="nx">npm</span> <span class="nx">install</span> <span class="o">-</span><span class="nx">g</span> <span class="nx">react</span><span class="o">-</span><span class="kr">native</span><span class="o">-</span><span class="nx">cli</span>
</code></pre></div><p> 这使用 Node 包管理器抓取 CLI 工具，并且全局安装；`npm` 在功能上与 CocoaPods 或者 Carthage 类似。<br></p><p>
浏览到你想要创建 React Native 应用的文件夹下，使用 CLI 工具构建项目：</p><div class="highlight"><pre><code class="language-js"><span class="nx">react</span><span class="o">-</span><span class="kr">native</span> <span class="nx">init</span> <span class="nx">PropertyFinder</span>
</code></pre></div><p> 现在，已经创建了一个初始项目，包含了创建和运行一个 React Native 应用所需的一切。<br></p><p> 如果仔细观察了创建的文件夹和文件，你会发现一个 <i>node_modules</i> 文件夹，包含了 React Native 框架。你也会发现一个 <i>index.ios.js</i> 文件，这是 CLI 工具创建的一个空壳应用。最后，会出现一个 Xcode 项目文件和一个 iOS 文件夹，包含了少量的代码用来引入 <i>bootstrap</i> 到你的项目中。</p><p> 打开 Xcode 项目文件，然后创建并运行。模拟器将会启动并且展示下面的问候语：<br></p><img src="./深入浅出 React Native：使用 JavaScript 构建原生应用 - 前端外刊评论 - 知乎专栏_files/abe1dbe5bf178ec5db1d7098387675ee_b.jpg" data-rawwidth="281" data-rawheight="500" class="content_image" width="281"><p>
你可以能发现，有一个终端窗口弹出，输出了下面的信息：</p><div class="highlight"><pre><code class="language-js"><span class="nx">$</span> <span class="nx">npm</span> <span class="nx">start</span>

<span class="o">&gt;</span> <span class="nx">react</span><span class="o">-</span><span class="kr">native</span><span class="err">@</span><span class="mf">0.1</span><span class="p">.</span><span class="mi">0</span> <span class="nx">start</span> <span class="o">/</span><span class="nx">Users</span><span class="o">/</span><span class="nx">colineberhardt</span><span class="o">/</span><span class="nx">Projects</span><span class="o">/</span><span class="nx">react</span><span class="o">-</span><span class="kr">native</span>
<span class="o">&gt;</span> <span class="p">.</span><span class="o">/</span><span class="nx">packager</span><span class="o">/</span><span class="nx">packager</span><span class="p">.</span><span class="nx">sh</span>

 <span class="o">===============================================================</span>
 <span class="o">|</span>  <span class="nx">Running</span> <span class="nx">packager</span> <span class="nx">on</span> <span class="nx">port</span> <span class="mi">8081</span><span class="p">.</span>       
 <span class="o">|</span>  <span class="nx">Keep</span> <span class="k">this</span> <span class="nx">packager</span> <span class="nx">running</span> <span class="k">while</span> <span class="nx">developing</span> <span class="nx">on</span> <span class="nx">any</span> <span class="nx">JS</span>         
 <span class="o">|</span>  <span class="nx">projects</span><span class="p">.</span> <span class="nx">Feel</span> <span class="nx">free</span> <span class="nx">to</span> <span class="nx">close</span> <span class="k">this</span> <span class="nx">tab</span> <span class="nx">and</span> <span class="nx">run</span> <span class="nx">your</span> <span class="nx">own</span>      
 <span class="o">|</span>  <span class="nx">packager</span> <span class="nx">instance</span> <span class="k">if</span> <span class="nx">you</span> <span class="nx">prefer</span><span class="p">.</span>                              
 <span class="o">|</span>                                                              
 <span class="o">|</span>     <span class="nx">https</span><span class="o">:</span><span class="c1">//github.com/facebook/react-native                 </span>
 <span class="o">|</span>                                                              
 <span class="o">===============================================================</span>


    <span class="nx">React</span> <span class="nx">packager</span> <span class="nx">ready</span><span class="p">.</span>
</code></pre></div><p>
这就是 React Native 包，在 node 下运行。一会儿你就会知道它是用来干什么的。</p><p>不要关闭终端窗口；就然它在后台运行。如果你不小心关了，只需要停下来使用 Xcode 重新运行项目。</p><blockquote><p>注意：在进入编码工作之前，还有最后一件事 —— 在这个教程中，你需要编写大量的 JavaScript 代码，Xcode 并非是最好的工具！我使用 <a href="http://www.sublimetext.com/" class=" wrap external" target="_blank" rel="nofollow noreferrer">Sublime Text<i class="icon-external"></i></a>，一个价格合理且应用广泛的编辑器。不过，<a href="https://atom.io/" class=" wrap external" target="_blank" rel="nofollow noreferrer">atom<i class="icon-external"></i></a>，<a href="http://brackets.io/" class=" wrap external" target="_blank" rel="nofollow noreferrer">brackets<i class="icon-external"></i></a> 或者其他轻量的编辑器都能胜任这份工作。</p></blockquote><h2>React Native 你好</h2><p>在开始“搜房App”之前，先来个简单的 Hello World App 热热身。在这一节里，你将会使用到一些组件。</p><p>在你钟爱的编辑其中打开 index.ios.js，删除当前的内容，因为你要从头构建你自己的应用。然后在文件顶部增加下面这样一行：：<br></p><div class="highlight"><pre><code class="language-js"><span class="s1">'use strict'</span><span class="p">;</span>
</code></pre></div><p>这行代码是用于开启 <strong>Strict Mode</strong>，Strict mode的错误处理可以有所提高，JavaScript的一些语言缺陷也可以避免。简而言之就是，JavaScript在这种模式下工作地更好！</p><blockquote><p>注意：想要研究一下 Strict Mode 的朋友，我会推荐你阅读 <a href="http://ejohn.org/blog/ecmascript-5-strict-mode-json-and-more/" class=" wrap external" target="_blank" rel="nofollow noreferrer">Jon Resig 的文章:“ECMAScript 5 Strict Mode, JSON, and More”<i class="icon-external"></i></a></p></blockquote><p>然后，加上这一行：</p><div class="highlight"><pre><code class="language-js"><span class="kd">var</span> <span class="nx">React</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'react-native'</span><span class="p">);</span>
</code></pre></div><p>这句代码是将 react-native 模块加载进来，并将它赋值给变量 React 的。React Native 使用同 Node.js 相同的模块加载方式：require，这个概念可以等同于 Swift 中的“链接库”或者“导入库”。</p><blockquote><p>注意：想要了解更多关于 JavaScript 模块的知识，我推荐阅读<a href="http://addyosmani.com/writing-modular-js/" class=" wrap external" target="_blank" rel="nofollow noreferrer"> Addy Osmani 写的这篇文章<i class="icon-external"></i></a>。</p></blockquote><p>在 require 语句的下面，加上这一段：</p><div class="highlight"><pre><code class="language-css"><span class="nt">var</span> <span class="nt">styles</span> <span class="o">=</span> <span class="nt">React</span><span class="nc">.StyleSheet.create</span><span class="o">(</span><span class="p">{</span>
  <span class="k">text</span><span class="o">:</span> <span class="err">{</span>
    <span class="k">color</span><span class="o">:</span> <span class="s1">'black'</span><span class="o">,</span>
    <span class="n">backgroundColor</span><span class="o">:</span> <span class="s1">'white'</span><span class="o">,</span>
    <span class="n">fontSize</span><span class="o">:</span> <span class="m">30</span><span class="o">,</span>
    <span class="k">margin</span><span class="o">:</span> <span class="m">80</span>
  <span class="p">}</span>
<span class="err">}</span><span class="o">);</span>
</code></pre></div><p>以上代码定义了一段应用在 “Hello World” 文本上的样式。如果你曾接触过Web开发，那你很可能已经发现了：React Native 使用的是 <a href="http://www.w3schools.com/css/" class=" wrap external" target="_blank" rel="nofollow noreferrer">CSS<i class="icon-external"></i></a> 来定义应用界面的样式。</p><p>现在我们来关注应用本身吧！依然是在相同的文件下，将以下代码添加到样式代码的下面：</p><div class="highlight"><pre><code class="language-js"><span class="kr">class</span> <span class="nx">PropertyFinderApp</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="nx">React</span><span class="p">.</span><span class="nx">Text</span><span class="p">,</span> <span class="p">{</span><span class="nx">style</span><span class="o">:</span> <span class="nx">styles</span><span class="p">.</span><span class="nx">text</span><span class="p">},</span> <span class="s2">"Hello World!"</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>是的，奏是 JavaScript class！</p><p>类 (class) 是在ES6中被引入的，纵然JavaScript一直在进步，但Web开发者受困于兼容浏览器的状况中，不能怎么使用JS的新特性。React Native运行在JavaScriptCore中是，也就是说，你可以使用JS的新特性啦，完全不用担心兼容什么的呢。</p><blockquote><p>注意：如果你是一名 Web 开发者，我百分百鼓励你要使用现代的JavaScript，然后使用像 <a href="https://babeljs.io/" class=" wrap external" target="_blank" rel="nofollow noreferrer">Babel<i class="icon-external"></i></a> 这样的工具生成兼容性的 JavaScript，用于支持兼容性不好的老浏览器。</p></blockquote><p>PropertyFinderApp 继承了 React.Component（React UI的基础模块）。组件包含着不可变的属性，可变的状态变量以及暴露给渲染用的方法。这会你做的应用比较简单，只用一个渲染方法就可以啦。</p><p>React Native 组件并不是 UIKit 类，它们只能说是在某种程度上等同。框架只是将 React 组件树转化成为原生的UI。</p><p>最后一步啦，将这一行加在文件末尾：</p><div class="highlight"><pre><code class="language-js"><span class="nx">React</span><span class="p">.</span><span class="nx">AppRegistry</span><span class="p">.</span><span class="nx">registerComponent</span><span class="p">(</span><span class="s1">'PropertyFinder'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">PropertyFinderApp</span> <span class="p">});</span>
</code></pre></div><p>AppRegistry 定义了App的入口，并提供了根组件。</p><p>保存 <strong>PropertyFinderApp.js</strong>，回到Xcode中。确保 <strong>PropertyFinder</strong> 规划（scheme）已经勾选了，并设置了相应的 iPhone 模拟器，然后生成并运行你的项目。几秒之后，你应该就可以看到 “Hello World” 应用正在运行了：</p><img src="./深入浅出 React Native：使用 JavaScript 构建原生应用 - 前端外刊评论 - 知乎专栏_files/80b700261430c5da1da10c9034afbc6b_b.jpg" data-rawwidth="281" data-rawheight="500" class="content_image" width="281">这个JavaScript应用运行在模拟器上，使用的是原生UI，没有任何内嵌的浏览器哦！<p>还不相信这是真的？:] 那打开你的 Xcode，选择 <strong>Debug\View Debugging\Capture View Hierarchy</strong>，你看 <strong>native view hierarchy</strong> 中都没有 UIWebView，就只有一个原生的view！:]</p><img src="./深入浅出 React Native：使用 JavaScript 构建原生应用 - 前端外刊评论 - 知乎专栏_files/a54cf6d88da1ca1a2d32bc8e47806698_b.jpg" data-rawwidth="480" data-rawheight="227" class="origin_image zh-lightbox-thumb" width="480" data-original="http://pic1.zhimg.com/a54cf6d88da1ca1a2d32bc8e47806698_r.jpg"><p>你一定很好奇其中的原理吧，那就在 Xcode 中打开 <strong>AppDelegate.m</strong>，接着找到 application:didFinishLaunchingWithOptions：这个方法构建了 RCTRootView 用于加载 JavaScript 应用以及渲染最后的视图的。</p><p>当应用开始运行的时候，RCTRootView将会从以下的URL中加载应用：</p><div class="highlight"><pre><code class="language-text">http://localhost:8081/index.ios.bundle
</code></pre></div><p>重新调用了你在运行这个App时打开的终端窗口，它开启了一个 packager 和 server 来处理上面的请求。</p><p>在 Safari 中打开那个 URL；你将会看到这个 App 的 JavaScript 代码。你也可以在 React Native 框架中找到你的 “Hello World” 代码。</p><p>当你的App开始运行了以后，这段代码将会被加载进来，然后 JavaScriptCore 框架将会执行它。在 Hello World 的例子里，它将会加载 PropertyFinderApp 组件，然后构建出原生的 UIKit 视图。关于这部分的内容，后文里会再详细解释的。</p><br><h2>你好 JSX 的世界</h2><p>你当前的应用程序会使用 React.createElement 来构建应用 UI ,React会将其转换到原生环境中。在当前情况下，你的JavaScript代码是完全可读的,但一个更复杂的 UI 与嵌套的元素将迅速使代码变成一大坨。 <br><br>确保应用程序仍在运行,然后回到你的文本编辑器中，编辑 PropertyFinderApp.js 。修改组件 render 方法的返回语句如下:</p><div class="highlight"><pre><code class="language-js"><span class="k">return</span> <span class="o">&lt;</span><span class="nx">React</span><span class="p">.</span><span class="nx">Text</span> <span class="nx">style</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">text</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">Hello</span> <span class="nx">World</span> <span class="p">(</span><span class="nx">Again</span><span class="p">)</span><span class="o">&lt;</span><span class="err">/React.Text&gt;;</span>
</code></pre></div><p>这是 JSX ，或 JavaScript 语法扩展,它直接在你的 JavaScript 代码中混合了类似 HTML 的语法;如果你是一个 web 开发人员,应该对此不陌生。在本篇文章中你将一直使用 JSX 。</p><p>把你的改动保存到 PropertyFinderApp.js 中，并返回到模拟器。按下 Cmd + R ,你将看到你的应用程序刷新,并显示更新的消息 “Hello World(again)”。</p><p>重新运行一个 React Native 应用程序像刷新 web 浏览器一样简单!:]</p><p>因为你会使用相同的一系列 JavaScript 文件,您可以让应用程序一直运行,只在更改和保存 PropertyFinderApp.js 后刷新即可</p><blockquote><p>注意:如果你感到好奇,可以看看你的“包”在浏览器中，JSX被转换成什么。</p></blockquote><p>这个 “Hello World” 已经够大家玩耍了,是时候构建实际的应用程序了!</p><br><h2>添加导航</h2><p>我们的房产查找应用使用标准的栈式导航，基于 UIKit 的 navigation controller。现在正是添加的时候。</p><p>在 index.ios.js 文件中，把 PropertyFinderApp 重命名为HelloWorld：</p><div class="highlight"><pre><code class="language-js"><span class="kr">class</span> <span class="nx">HelloWorld</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
</code></pre></div><p>“Hello World” 这几个字你还需要让它显示一会儿，但它不再是应用的根组件了。</p><p>接下来，在 HelloWorld 这个组件下面添加如下这个类：</p><div class="highlight"><pre><code class="language-js"><span class="kr">class</span> <span class="nx">PropertyFinderApp</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">React</span><span class="p">.</span><span class="nx">NavigatorIOS</span>
        <span class="nx">style</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">container</span><span class="p">}</span>
        <span class="nx">initialRoute</span><span class="o">=</span><span class="p">{{</span>
          <span class="nx">title</span><span class="o">:</span> <span class="s1">'Property Finder'</span><span class="p">,</span>
          <span class="nx">component</span><span class="o">:</span> <span class="nx">HelloWorld</span><span class="p">,</span>
        <span class="p">}}</span><span class="o">/&gt;</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>构造一个 navigation controller，应用一个样式，并把初始路由设为 Hello World 组件。在 Web 开发中，路由就是一种定义应用导航的一种技术，即定义页面——或者说是路由——与 URL 的对应关系。</p><p>在同一个文件中，更新样式定义，包含如下 container 的样式：</p><div class="highlight"><pre><code class="language-js"><span class="kd">var</span> <span class="nx">styles</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">StyleSheet</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
  <span class="nx">text</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">color</span><span class="o">:</span> <span class="s1">'black'</span><span class="p">,</span>
    <span class="nx">backgroundColor</span><span class="o">:</span> <span class="s1">'white'</span><span class="p">,</span>
    <span class="nx">fontSize</span><span class="o">:</span> <span class="mi">30</span><span class="p">,</span>
    <span class="nx">margin</span><span class="o">:</span> <span class="mi">80</span>
  <span class="p">},</span>
  <span class="nx">container</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">flex</span><span class="o">:</span> <span class="mi">1</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div><p>在随后的教程中会告诉你 flex: 1 是什么意思。</p><p>回到模拟器，Cmd+R，看看新 UI 的样子：</p><img src="./深入浅出 React Native：使用 JavaScript 构建原生应用 - 前端外刊评论 - 知乎专栏_files/5a8cd3dc5eaee2cbf0c91c3b939044a4_b.jpg" data-rawwidth="281" data-rawheight="500" class="content_image" width="281">这就是包含了 root view 的 navigation controller，目前 root view 就是 “Hello World”。很棒——应用已经有了基础的导航结构，到添加<strong>真实</strong> UI 的时候了。<br><h2>创建搜索页</h2><p>在项目中添加一个新文件，命名为 SearchPage.js，然后将其放在PropertyFinderApp.js 所在目录下。在文件中添加下面代码：</p><div class="highlight"><pre><code class="language-js"><span class="s1">'use strict'</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">React</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'react-native'</span><span class="p">);</span>
<span class="kd">var</span> <span class="p">{</span>
  <span class="nx">StyleSheet</span><span class="p">,</span>
  <span class="nx">Text</span><span class="p">,</span>
  <span class="nx">TextInput</span><span class="p">,</span>
  <span class="nx">View</span><span class="p">,</span>
  <span class="nx">TouchableHighlight</span><span class="p">,</span>
  <span class="nx">ActivityIndicatorIOS</span><span class="p">,</span>
  <span class="nx">Image</span><span class="p">,</span>
  <span class="nx">Component</span>
<span class="p">}</span> <span class="o">=</span> <span class="nx">React</span><span class="p">;</span>
</code></pre></div><p>你会注意到，位于引入 react-native 所在位置的前面有一个严格模式标识，紧接着的声明语句是新知识。</p><p>这是一种解构赋值，准许你获取对象的多个属性并且使用一条语句将它们赋给多个变量。结果是，后面的代码中可以省略掉 React 前缀；比如，你可以直接引用 StyleSheet ，而不再需要 React.StyleSheet。解构同样适用于操作数组，<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment" class=" wrap external" target="_blank" rel="nofollow noreferrer">更多细节请戳这里<i class="icon-external"></i></a>。</p><p>继续在 SearchPage.js 文件中添加下面的样式：</p><div class="highlight"><pre><code class="language-js"><span class="kd">var</span> <span class="nx">styles</span> <span class="o">=</span> <span class="nx">StyleSheet</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
  <span class="nx">description</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">marginBottom</span><span class="o">:</span> <span class="mi">20</span><span class="p">,</span>
    <span class="nx">fontSize</span><span class="o">:</span> <span class="mi">18</span><span class="p">,</span>
    <span class="nx">textAlign</span><span class="o">:</span> <span class="s1">'center'</span><span class="p">,</span>
    <span class="nx">color</span><span class="o">:</span> <span class="s1">'#656565'</span>
  <span class="p">},</span>
  <span class="nx">container</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">padding</span><span class="o">:</span> <span class="mi">30</span><span class="p">,</span>
    <span class="nx">marginTop</span><span class="o">:</span> <span class="mi">65</span><span class="p">,</span>
    <span class="nx">alignItems</span><span class="o">:</span> <span class="s1">'center'</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div><p>同样，以上都是标准的 CSS 属性。和 Interface Builder 相比，这样设置样式缺少了可视化，但是比起在 viewDidLoad() 中逐个设置视图属性的做法更友好！</p><p>只需要把组件添加到样式声明的前面：</p><div class="highlight"><pre><code class="language-js"><span class="kr">class</span> <span class="nx">SearchPage</span> <span class="kr">extends</span> <span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">View</span> <span class="nx">style</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">container</span><span class="p">}</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">Text</span> <span class="nx">style</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">description</span><span class="p">}</span><span class="o">&gt;</span>
          <span class="nx">Search</span> <span class="k">for</span> <span class="nx">houses</span> <span class="nx">to</span> <span class="nx">buy</span><span class="o">!</span>
        <span class="o">&lt;</span><span class="err">/Text&gt;</span>
        <span class="o">&lt;</span><span class="nx">Text</span> <span class="nx">style</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">description</span><span class="p">}</span><span class="o">&gt;</span>
          <span class="nx">Search</span> <span class="nx">by</span> <span class="nx">place</span><span class="o">-</span><span class="nx">name</span><span class="p">,</span> <span class="nx">postcode</span> <span class="nx">or</span> <span class="nx">search</span> <span class="nx">near</span> <span class="nx">your</span> <span class="nx">location</span><span class="p">.</span>
        <span class="o">&lt;</span><span class="err">/Text&gt;</span>
      <span class="o">&lt;</span><span class="err">/View&gt;</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>render 很好地展示出 JSX 以及它表示的结构。通过这个样式，你可以轻易地描绘出组件 UI 的结构：一个容器，包含两个 text 标签。</p><p>最后，将下面的代码添加到文件末尾：</p><div class="highlight"><pre><code class="language-js"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">SearchPage</span><span class="p">;</span>
</code></pre></div><p>这可以 export SearchPage 类，方便在其他文件中使用它。</p><p>下一步是更新应用的路由，以初始化路由。</p><p>打开 PropertyFinderApp.js，在文件顶部紧接着上一个 require 语句的位置添加下面代码：</p><div class="highlight"><pre><code class="language-js"><span class="kd">var</span> <span class="nx">SearchPage</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'./SearchPage'</span><span class="p">);</span>
</code></pre></div><p>在 PropertyFinderApp 类的 render 函数内部，通过更新 initialRoute 来引用最新添加的页面，如下：</p><div class="highlight"><pre><code class="language-js"><span class="nx">component</span><span class="o">:</span> <span class="nx">SearchPage</span>
</code></pre></div><p>此时，如果你愿意则可以移除 HelloWorld 类以及与它相关联的样式。你不在需要那段代码了。</p><p>切换到模拟器，按下 Cmd+R 查看新的 UI：</p><img src="./深入浅出 React Native：使用 JavaScript 构建原生应用 - 前端外刊评论 - 知乎专栏_files/cbe4401c09d061f7755ef80a353933b9_b.jpg" data-rawwidth="281" data-rawheight="500" class="content_image" width="281">使用 Flexbox 定义外观<p>现在，你已经看到了用基本的 CSS 属性来控制外间距（margin），内间距（padding）还有颜色（color）。不过，可能你还不太了解要如何使用伸缩盒（flexbox），flexbox 是最近新加入 CSS 规范，用它就能很便利地布局界面。</p><p>React Native 用 <a href="https://github.com/facebook/css-layout" class=" wrap external" target="_blank" rel="nofollow noreferrer">css-layout<i class="icon-external"></i></a>（这是一个用 JavaScript 实现flexbox标准然后编译成 C（iOS平台）或者Java（Android平台）的库)。</p><p>Facebook把这个项目单独出来实在太正确了，这样可以编译成多种语言，促进更多新颖的应用的发展，比如<a href="http://blog.scottlogic.com/2015/02/02/svg-layout-flexbox.html" class=" wrap external" target="_blank" rel="nofollow noreferrer">flexbox layout to SVG<i class="icon-external"></i></a>。</p><p>在你的App中，容器（container）默认地是纵向布局，也就是说在它的子元素将会竖直地排列，像这样： <br></p><img src="./深入浅出 React Native：使用 JavaScript 构建原生应用 - 前端外刊评论 - 知乎专栏_files/e07a20540d130f08167c93d1c6f0f540_b.jpg" data-rawwidth="634" data-rawheight="471" class="origin_image zh-lightbox-thumb" width="634" data-original="http://pic3.zhimg.com/e07a20540d130f08167c93d1c6f0f540_r.jpg">这被称为主轴 (main axis)，它的方向可以是竖直的也可以是水平的。<p>每一个子元素在竖直方向上的位置是由它的margin，height和padding共同决定的。容器的 alignItems 属性也要设置成 center，这个属性可以控制子元素在十字轴上的位置。在这里，它实现了居中对齐的文本。</p><p>好啦，现在我们把输入框和按钮加上去吧。打开 <strong>SearchPage.js</strong>，将下面的代码插入第二个 Text 元素的后面：</p><div class="highlight"><pre><code class="language-js"><span class="o">&lt;</span><span class="nx">View</span> <span class="nx">style</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">flowRight</span><span class="p">}</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nx">TextInput</span>
    <span class="nx">style</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">searchInput</span><span class="p">}</span>
    <span class="nx">placeholder</span><span class="o">=</span><span class="s1">'Search via name or postcode'</span><span class="o">/&gt;</span>
  <span class="o">&lt;</span><span class="nx">TouchableHighlight</span> <span class="nx">style</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">button</span><span class="p">}</span>
      <span class="nx">underlayColor</span><span class="o">=</span><span class="s1">'#99d9f4'</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">Text</span> <span class="nx">style</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">buttonText</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">Go</span><span class="o">&lt;</span><span class="err">/Text&gt;</span>
  <span class="o">&lt;</span><span class="err">/TouchableHighlight&gt;</span>
<span class="o">&lt;</span><span class="err">/View&gt;</span>
<span class="o">&lt;</span><span class="nx">TouchableHighlight</span> <span class="nx">style</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">button</span><span class="p">}</span>
    <span class="nx">underlayColor</span><span class="o">=</span><span class="s1">'#99d9f4'</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nx">Text</span> <span class="nx">style</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">buttonText</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">Location</span><span class="o">&lt;</span><span class="err">/Text&gt;</span>
<span class="o">&lt;</span><span class="err">/TouchableHighlight&gt;</span>
</code></pre></div><p>现在你已经加上了两个最高等级的视图（top-level view），一个视图包含了文本输入框和一个按钮，还有一个视图内只有一个按钮。在后文中你会看到，它们的样式是什么样的。</p><p>接着，添加上对应的样式：</p><div class="highlight"><pre><code class="language-js"><span class="nx">flowRight</span><span class="o">:</span> <span class="p">{</span>
  <span class="nx">flexDirection</span><span class="o">:</span> <span class="s1">'row'</span><span class="p">,</span>
  <span class="nx">alignItems</span><span class="o">:</span> <span class="s1">'center'</span><span class="p">,</span>
  <span class="nx">alignSelf</span><span class="o">:</span> <span class="s1">'stretch'</span>
<span class="p">},</span>
<span class="nx">buttonText</span><span class="o">:</span> <span class="p">{</span>
  <span class="nx">fontSize</span><span class="o">:</span> <span class="mi">18</span><span class="p">,</span>
  <span class="nx">color</span><span class="o">:</span> <span class="s1">'white'</span><span class="p">,</span>
  <span class="nx">alignSelf</span><span class="o">:</span> <span class="s1">'center'</span>
<span class="p">},</span>
<span class="nx">button</span><span class="o">:</span> <span class="p">{</span>
  <span class="nx">height</span><span class="o">:</span> <span class="mi">36</span><span class="p">,</span>
  <span class="nx">flex</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="nx">flexDirection</span><span class="o">:</span> <span class="s1">'row'</span><span class="p">,</span>
  <span class="nx">backgroundColor</span><span class="o">:</span> <span class="s1">'#48BBEC'</span><span class="p">,</span>
  <span class="nx">borderColor</span><span class="o">:</span> <span class="s1">'#48BBEC'</span><span class="p">,</span>
  <span class="nx">borderWidth</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="nx">borderRadius</span><span class="o">:</span> <span class="mi">8</span><span class="p">,</span>
  <span class="nx">marginBottom</span><span class="o">:</span> <span class="mi">10</span><span class="p">,</span>
  <span class="nx">alignSelf</span><span class="o">:</span> <span class="s1">'stretch'</span><span class="p">,</span>
  <span class="nx">justifyContent</span><span class="o">:</span> <span class="s1">'center'</span>
<span class="p">},</span>
<span class="nx">searchInput</span><span class="o">:</span> <span class="p">{</span>
  <span class="nx">height</span><span class="o">:</span> <span class="mi">36</span><span class="p">,</span>
  <span class="nx">padding</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
  <span class="nx">marginRight</span><span class="o">:</span> <span class="mi">5</span><span class="p">,</span>
  <span class="nx">flex</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
  <span class="nx">fontSize</span><span class="o">:</span> <span class="mi">18</span><span class="p">,</span>
  <span class="nx">borderWidth</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="nx">borderColor</span><span class="o">:</span> <span class="s1">'#48BBEC'</span><span class="p">,</span>
  <span class="nx">borderRadius</span><span class="o">:</span> <span class="mi">8</span><span class="p">,</span>
  <span class="nx">color</span><span class="o">:</span> <span class="s1">'#48BBEC'</span>
<span class="p">}</span>
</code></pre></div><p>要注意格式问题：每一个样式都是用逗号分隔开的，所以别忘了在container 选择器后面还要加上一个逗号。</p><p>以上的样式将会应用在你刚刚加上的输入框和按钮上。</p><p>现在返回到模拟器，然后按下 Cmd+R 刷新界面： <br></p><img src="./深入浅出 React Native：使用 JavaScript 构建原生应用 - 前端外刊评论 - 知乎专栏_files/10077dcc4cdc5d66f87e572203e96fc2_b.jpg" data-rawwidth="281" data-rawheight="500" class="content_image" width="281">文本区域和 ’Go’ 按钮在同一行，不需要显式地定义两个组件的宽度，你只需要将它们放在同一个容器中，加上 flexDirection:'row' 样式，再定义好它们的 flex 值。文本区域是 flex:4，按钮则是 flex:1，这说明两者的宽度比是4:1。<p>大概你也发现了，你的“按钮”其实并不是按钮！:] 使用了 UIKit 后，按钮更倾向于是可以轻碰（tap）的标签（label），所以 React Native 团队决定直接在 JavaScript 中构建按钮了。所以你在 App 中使用的按钮是 TouchableHighlight，这是一个 React Native 组件，当轻碰 TouchableHighlight 时，它会变得透明从而显示出衬底的颜色（也就是按钮下层的组件颜色）。</p><p>搜索界面的最后一步就是加上一张图片.你可以从<a href="http://cdn2.raywenderlich.com/wp-content/uploads/2015/03/ReactNative-HouseImage.zip" class=" wrap external" target="_blank" rel="nofollow noreferrer">这里下载我们用的图片素材<i class="icon-external"></i></a>并解压。</p><p>在Xcode中打开<strong>Images.xcassets</strong>文件，点击加号添加一个新的图片集。然后将图片素材拖进正确的“区间”： <br></p><img src="./深入浅出 React Native：使用 JavaScript 构建原生应用 - 前端外刊评论 - 知乎专栏_files/7fd915417400b22cde8a274924fa7808_b.jpg" data-rawwidth="700" data-rawheight="459" class="origin_image zh-lightbox-thumb" width="700" data-original="http://pic3.zhimg.com/7fd915417400b22cde8a274924fa7808_r.jpg"><p>你需要重启应用才能让图片生效。</p><p>将以下代码添加到 TouchableHighlight 组件后面，它将用于“获取位置”按钮：</p><div class="highlight"><pre><code class="language-js"><span class="o">&lt;</span><span class="nx">Image</span> <span class="nx">source</span><span class="o">=</span><span class="p">{</span><span class="nx">require</span><span class="p">(</span><span class="s1">'image!house'</span><span class="p">)}</span> <span class="nx">style</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">image</span><span class="p">}</span><span class="o">/&gt;</span>
</code></pre></div><p>现在再样式表的最后加上图片对应的样式，别忘了给原样式中最后一个加上逗号哦：</p><div class="highlight"><pre><code class="language-js"><span class="nx">image</span><span class="o">:</span> <span class="p">{</span>
  <span class="nx">width</span><span class="o">:</span> <span class="mi">217</span><span class="p">,</span>
  <span class="nx">height</span><span class="o">:</span> <span class="mi">138</span>
<span class="p">}</span>
</code></pre></div><p>require('image!house') 语句用于确定在你应用的asset目录下的图片资源，在 Xcode 中，如果你的打开了 <strong>Images.xcassets</strong>，你会看到一个“房屋”的图标，正是上面代码中引用到的。</p><p>返回到模拟器，Cmd+R刷新UI： <br></p><img src="./深入浅出 React Native：使用 JavaScript 构建原生应用 - 前端外刊评论 - 知乎专栏_files/73421776c82a309841db13177bfa261d_b.jpg" data-rawwidth="281" data-rawheight="500" class="content_image" width="281"><blockquote><p>注意：如果你这会没有看到“房屋”图片，取而代之的是一张“找不到资源”的图片，尝试重启packager（也就是在终端里输入 npm start 命令）。</p></blockquote><p>现在你的应用看起来挺不错的啦，不过它还少了点功能。接下来你的任务就是给它加上点状态，让它执行一些操作。</p><br><h2>添加组件状态</h2><p>每个 React 组件都带有一个key-value存储的状态对象，你必须在组件渲染之前设置其初始状态。</p><p>在 SearchPage.js 中，我们对 SearchPage 类中，render方法前添加以下的代码。</p><div class="highlight"><pre><code class="language-js"><span class="nx">constructor</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
  <span class="kr">super</span><span class="p">(</span><span class="nx">props</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">searchString</span><span class="o">:</span> <span class="s1">'london'</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre></div><p>现在你的组件拥有一个状态变量：searchString ，且初始值被设置为 london 。</p><p>这时候你需要利用起组件中的状态了。在render方法中，用以下的代码替换TextInput元素中的内容：</p><div class="highlight"><pre><code class="language-js"><span class="o">&lt;</span><span class="nx">TextInput</span>
  <span class="nx">style</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">searchInput</span><span class="p">}</span>
  <span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">searchString</span><span class="p">}</span>
  <span class="nx">placeholder</span><span class="o">=</span><span class="s1">'Search via name or postcode'</span><span class="o">/&gt;</span>
</code></pre></div><p>这一步设置了 TextInput 组件 value 属性的值，这个值用于把状态变量 searchString 的当前值作为展示给用户的文字。我们已经考虑初始值的设定了，但如果用户编辑这里的文字会发生什么呢？</p><p>第一步需要建立一个方法来处理事件。在 SearchPage 类中添加以下的代码：</p><div class="highlight"><pre><code class="language-js"><span class="nx">onSearchTextChanged</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'onSearchTextChanged'</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="nx">searchString</span><span class="o">:</span> <span class="nx">event</span><span class="p">.</span><span class="nx">nativeEvent</span><span class="p">.</span><span class="nx">text</span> <span class="p">});</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">searchString</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><p>上面的代码从 events 中取出了 text 属性的值，并用于更新组件的状态。这里面也添加了一些有用的调试代码。</p><p>当文字改变时，需要让这个方法被调用，调用后的文字会通过 render 函数返回到组件中。因此我们需要在标签上添加一个 onChange 属性，添加后的标签如下所示：</p><div class="highlight"><pre><code class="language-js"><span class="o">&lt;</span><span class="nx">TextInput</span>
  <span class="nx">style</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">searchInput</span><span class="p">}</span>
  <span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">searchString</span><span class="p">}</span>
  <span class="nx">onChange</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">onSearchTextChanged</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)}</span>
  <span class="nx">placeholder</span><span class="o">=</span><span class="s1">'Search via name or postcode'</span><span class="o">/&gt;</span>
</code></pre></div><p>当用户更改文本时,会调用 onChange 上 的函数;在本例中,则是 onSearchTextChanged 。</p><blockquote><p>注意:你估计会对 bind(this) 语句有疑问。在 JavaScript 中，this 这个关键字有点不同于大多数其他语言;在 Swift 表示 “自身”。在这种情况中，bind 可以确保在 onSearchTextChanged 方法中, this 可以作为组件实例的引用。有关更多信息,请参见<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/this" class=" wrap external" target="_blank" rel="nofollow noreferrer">MDN this<i class="icon-external"></i></a>页面。</p></blockquote><p>在你再次刷新你的应用程序之前，还有一个步骤:在 return 前添加以下语句，打印一条日志来记录 render() 函数的调用:</p><div class="highlight"><pre><code class="language-js"> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'SearchPage.render'</span><span class="p">);</span>
</code></pre></div><p>你会从这些日志语句中学到一些很有趣的东西!:]</p><p>回到你的模拟器,然后按Cmd + R。您现在应该看到文本输入的初始值为 “london” ,编辑一下文本，从而在 Xcode 控制台中产生一些日志: <br></p><img src="./深入浅出 React Native：使用 JavaScript 构建原生应用 - 前端外刊评论 - 知乎专栏_files/6656e0f8e9517685bffc220e2ca35e58_b.jpg" data-rawwidth="235" data-rawheight="73" class="content_image" width="235"><p>注意看上面的截图，日志打印的顺序看起来有些奇怪：</p><p>第一次调用 render() 函数用于设置视图。当文本变化时， onSearchTextChanged 函数被调用。之后，通过更新组件的状态来反映输入了新的文本,这会触发另一次 render 。 onSearchTextChanged() 函数也会被调用，会将改变的字符串打印出来。每当应用程序更新任何 React 组件,将会触发整个UI层的重新绘制,这会调用你所有组件的 render 方法。这是一个好主意,因为这样做把组件的渲染逻辑，从状态变化影响UI这一过程中完全解耦出来。</p><p>与其他大多数 UI 框架所不同的是,你既不需要在状态改变的时候去手动更新 UI ,或使用某种类型的绑定框架，来创建某种应用程序状态和它的 UI 表现的关联;例如,我的文章中讲的，<a href="http://www.raywenderlich.com/74106/mvvm-tutorial-with-reactivecocoa-part-1" class=" wrap external" target="_blank" rel="nofollow noreferrer">通过ReactiveCocoa实现MVVM模式<i class="icon-external"></i></a>。</p><p>在 React 中,你不再需要担心 UI 的哪些部分可能受到状态变化的影响;你的整个应用程序的 UI，都可以简单地表示为一个函数的状态。</p><p>此时，你可能已经发现了这一概念中一个根本性的缺陷。是的,非常准确——性能!</p><p>你肯定不能在 UI 变化时，完全抛弃掉整个 UI 然后重新绘制吧 <br>？这就是 React 高明的地方了。每当 UI 渲染出来后,render 方法会返回一颗视图渲染树,并与当前的 UIKit 视图进行比较。这个称之为 reconciliation 的过程的输出是一个简单的更新列表, React 会将这个列表应用到当前视图。这意味着，只有实际改变了的部分才会重新绘制。</p><p>这个令人拍案叫绝的崭新概念让ReactJS变得独特——virtual-DOM(文档对象模型,一个web文档的视图树)和 reconciliation 这些概念——被应用于iOS应用程序。</p><p>稍后你可以整理下思路,之后,在刚才的应用中你仍然有一些工作要做。日志代码增加了代码的繁琐性，已经不需要了，所以删除掉日志代码。</p><br><h2>初始化搜索功能</h2><p>为了实现搜索功能，你需要处理 “Go” 按钮的点击事件，调用对应的 API，并提供一个视觉效果，告诉用户正在做查询。</p><p>在 SearchPage.js 中，在构造函数中把初始状态更新成：</p><div class="highlight"><pre><code class="language-js"><span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">searchString</span><span class="o">:</span> <span class="s1">'london'</span><span class="p">,</span>
  <span class="nx">isLoading</span><span class="o">:</span> <span class="kc">false</span>
<span class="p">};</span>
</code></pre></div><p>新的 isLoading 属性将会记录是否有请求正在处理的状态。</p><p>在 render 开始的添加如下逻辑：</p><div class="highlight"><pre><code class="language-js"><span class="kd">var</span> <span class="nx">spinner</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">isLoading</span> <span class="o">?</span>
  <span class="p">(</span> <span class="o">&lt;</span><span class="nx">ActivityIndicatorIOS</span>
      <span class="nx">hidden</span><span class="o">=</span><span class="s1">'true'</span>
      <span class="nx">size</span><span class="o">=</span><span class="s1">'large'</span><span class="o">/&gt;</span> <span class="p">)</span> <span class="o">:</span>
  <span class="p">(</span> <span class="o">&lt;</span><span class="nx">View</span><span class="o">/&gt;</span><span class="p">);</span>
</code></pre></div><p>这是一个三元操作符，与 if 语句类似，即根据组件 isLoading 的状态，要么添加一个 indicator，要么添加一个空的 view。因为整个组件会不停地更新，所以你自由地混合 JSX 和 JavaSript 代码。</p><p>回到用 JSX 定义搜索界面的地方，在图片的下面添加：</p><div class="highlight"><pre><code class="language-js"><span class="p">{</span><span class="nx">spinner</span><span class="p">}</span>
</code></pre></div><p>给渲染“Go”的 TouchableHighlight 标记添加如下的属性：</p><div class="highlight"><pre><code class="language-js"><span class="nx">onPress</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">onSearchPressed</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)}</span>
</code></pre></div><p>接下来，添加下面这两个方法到 SearchPage 类中：</p><div class="highlight"><pre><code class="language-js"><span class="nx">_executeQuery</span><span class="p">(</span><span class="nx">query</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">query</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="nx">isLoading</span><span class="o">:</span> <span class="kc">true</span> <span class="p">});</span>
<span class="p">}</span>

<span class="nx">onSearchPressed</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">query</span> <span class="o">=</span> <span class="nx">urlForQueryAndPage</span><span class="p">(</span><span class="s1">'place_name'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">searchString</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_executeQuery</span><span class="p">(</span><span class="nx">query</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><p>_executeQuery() 之后会进行真实的查询，现在的话就是简单输出一条信息到控制台，并且把 isLoading 设置为对应的值，这样 UI 就可以显示新的状态了。</p><blockquote><p>提示：JavaScript 的类并没有访问修饰符，因此没有 “私有” 的该奶奶。因此常常会发现开发者使用一个下划线作为方法的前缀，来说明这些方法是私有方法。</p></blockquote><p>当 “Go” 按钮被点击时，onSearchPressed() 将会被调用，开始查询。</p><p>最后，添加下面这个工具函数在定义 SearchPage 类的上面：</p><div class="highlight"><pre><code class="language-js"><span class="kd">function</span> <span class="nx">urlForQueryAndPage</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">pageNumber</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">country</span><span class="o">:</span> <span class="s1">'uk'</span><span class="p">,</span>
      <span class="nx">pretty</span><span class="o">:</span> <span class="s1">'1'</span><span class="p">,</span>
      <span class="nx">encoding</span><span class="o">:</span> <span class="s1">'json'</span><span class="p">,</span>
      <span class="nx">listing_type</span><span class="o">:</span> <span class="s1">'buy'</span><span class="p">,</span>
      <span class="nx">action</span><span class="o">:</span> <span class="s1">'search_listings'</span><span class="p">,</span>
      <span class="nx">page</span><span class="o">:</span> <span class="nx">pageNumber</span>
  <span class="p">};</span>
  <span class="nx">data</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">querystring</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">key</span> <span class="o">=&gt;</span> <span class="nx">key</span> <span class="o">+</span> <span class="s1">'='</span> <span class="o">+</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="nx">key</span><span class="p">]))</span>
    <span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">'&amp;'</span><span class="p">);</span>

  <span class="k">return</span> <span class="s1">'http://api.nestoria.co.uk/api?'</span> <span class="o">+</span> <span class="nx">querystring</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div><ul><li>这个函数并不依赖 SearchPage，因此被定义成了一个独立的函数，而不是类方法。他首先通过 data 来定义查询字符串所需要的参数，接着将 data 转换成需要的字符串格式，name=value 对，使用 &amp; 符号分割。语法 =&gt; 是一个箭头函数，又一个<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/Arrow_functions" class=" wrap external" target="_blank" rel="nofollow noreferrer">对 JavaScript 语言的扩展<i class="icon-external"></i></a>，提供了这个便捷的语法来创建一个匿名函数。</li></ul><p>回到模拟器，Cmd+R，重新加载应用，点击 “Go” 按钮。你可以看到 activity indicator 显示出来，再看看 Xcode 的控制台：</p><img src="./深入浅出 React Native：使用 JavaScript 构建原生应用 - 前端外刊评论 - 知乎专栏_files/21d006d14798b7e8dc57e63f07d42d65_b.jpg" data-rawwidth="700" data-rawheight="169" class="origin_image zh-lightbox-thumb" width="700" data-original="http://pic1.zhimg.com/21d006d14798b7e8dc57e63f07d42d65_r.jpg"><p>activity indicator 渲染了，并且作为请求的 URL 出现在输出中。把 URL 拷贝到浏览器中访问看看得到的结果。你会看到大量的 JSON 对象。别担心——你不需要理解它们，之后会使用代码来解析之。</p><blockquote><p>提示：应用使用了 <a href="http://www.nestoria.co.uk/help/api" class=" wrap external" target="_blank" rel="nofollow noreferrer">Nestoria 的 API 来做房产的搜索<i class="icon-external"></i></a>。API 返回的 JSON 数据非常的直白。但是你也可以看看文档了解更多细节，请求什么 URL 地址，以及返回数据的格式。</p></blockquote><p>下一步就是从应用中发出请求。</p><br><h2>执行 API 请求</h2><p>还是 SearchPage.js 文件中，更新构造器中的初始 state 添加一个message 变量：</p><div class="highlight"><pre><code class="language-js"><span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">searchString</span><span class="o">:</span> <span class="s1">'london'</span><span class="p">,</span>
  <span class="nx">isLoading</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="nx">message</span><span class="o">:</span> <span class="s1">''</span>
<span class="p">};</span>
</code></pre></div><p>在 render 内部，将下面的代码添加到 UI 的底部：</p><div class="highlight"><pre><code class="language-js"><span class="o">&lt;</span><span class="nx">Text</span> <span class="nx">style</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">description</span><span class="p">}</span><span class="o">&gt;</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">message</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/Text&gt;</span>
</code></pre></div><p>你需要使用这个为用户展示多种信息。</p><p>在 SearchPage 类内部，将以下代码添加到 _executeQuery() 底部：</p><div class="highlight"><pre><code class="language-js"><span class="nx">fetch</span><span class="p">(</span><span class="nx">query</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span> <span class="o">=&gt;</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">json</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">_handleResponse</span><span class="p">(</span><span class="nx">json</span><span class="p">.</span><span class="nx">response</span><span class="p">))</span>
  <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span> <span class="o">=&gt;</span> 
     <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
      <span class="nx">isLoading</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="nx">message</span><span class="o">:</span> <span class="s1">'Something bad happened '</span> <span class="o">+</span> <span class="nx">error</span>
   <span class="p">}));</span>
</code></pre></div><p>这里使用了 fetch 函数，它是 <a href="https://fetch.spec.whatwg.org/" class=" wrap external" target="_blank" rel="nofollow noreferrer">Web API 的一部分<i class="icon-external"></i></a>。和 XMLHttpRequest 相比，它提供了更加先进的 API。异步响应会返回<a href="http://www.html5rocks.com/en/tutorials/es6/promises/" class=" wrap external" target="_blank" rel="nofollow noreferrer">一个 promise<i class="icon-external"></i></a>，成功的话会转化 JSON 并且为它提供了一个你将要添加的方法。</p><p>最后一步是将下面的函数添加到 SearchPage：</p><div class="highlight"><pre><code class="language-js"><span class="nx">_handleResponse</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="nx">isLoading</span><span class="o">:</span> <span class="kc">false</span> <span class="p">,</span> <span class="nx">message</span><span class="o">:</span> <span class="s1">''</span> <span class="p">});</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">application_response_code</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">===</span> <span class="s1">'1'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Properties found: '</span> <span class="o">+</span> <span class="nx">response</span><span class="p">.</span><span class="nx">listings</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="nx">message</span><span class="o">:</span> <span class="s1">'Location not recognized; please try again.'</span><span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>如果查询成功，这个方法会清除掉正在加载标识并且记录下查询到属性的个数。</p><blockquote><p>注意：Nestoria 有<a href="http://www.nestoria.co.uk/help/api-return-codes" class=" wrap external" target="_blank" rel="nofollow noreferrer">很多种返回码<i class="icon-external"></i></a>具备潜在的用途。比如，202 和 200 会返回最佳位置列表。当你创建完一个应用，为什么不处理一下这些，可以为用户呈现一个可选列表。</p></blockquote><p>保存项目，然后在模拟器中按下 Cmd+R，尝试搜索 ‘london’；你会在日志信息中看到 20 properties were found。然后随便尝试搜索一个不存在的位置，比如 ‘narnia’，你会得到下面的问候语。 <br></p><img src="./深入浅出 React Native：使用 JavaScript 构建原生应用 - 前端外刊评论 - 知乎专栏_files/3a4a28712b2169f7eea6dad169b2168e_b.jpg" data-rawwidth="281" data-rawheight="500" class="content_image" width="281">是时候看一下这20个房屋所对应的真实的地方，比如伦敦！<br><h2>结果显示</h2><p>创建一个新的文件，命名为 <strong>SearchResults.js</strong>，然后加上下面这段代码：</p><div class="highlight"><pre><code class="language-js"><span class="s1">'use strict'</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">React</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'react-native'</span><span class="p">);</span>
<span class="kd">var</span> <span class="p">{</span>
  <span class="nx">StyleSheet</span><span class="p">,</span>
  <span class="nx">Image</span><span class="p">,</span> 
  <span class="nx">View</span><span class="p">,</span>
  <span class="nx">TouchableHighlight</span><span class="p">,</span>
  <span class="nx">ListView</span><span class="p">,</span>
  <span class="nx">Text</span><span class="p">,</span>
  <span class="nx">Component</span>
<span class="p">}</span> <span class="o">=</span> <span class="nx">React</span><span class="p">;</span>
</code></pre></div><p>你肯定注意到啦，这里用到了 require 语句将 react-native 模块引入其中，还有一个重构赋值语句。</p><p>接着就是加入搜索结果的组件：</p><div class="highlight"><pre><code class="language-js"><span class="kr">class</span> <span class="nx">SearchResults</span> <span class="kr">extends</span> <span class="nx">Component</span> <span class="p">{</span>

  <span class="nx">constructor</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">super</span><span class="p">(</span><span class="nx">props</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">dataSource</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ListView</span><span class="p">.</span><span class="nx">DataSource</span><span class="p">(</span>
      <span class="p">{</span><span class="nx">rowHasChanged</span><span class="o">:</span> <span class="p">(</span><span class="nx">r1</span><span class="p">,</span> <span class="nx">r2</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">r1</span><span class="p">.</span><span class="nx">guid</span> <span class="o">!==</span> <span class="nx">r2</span><span class="p">.</span><span class="nx">guid</span><span class="p">});</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">dataSource</span><span class="o">:</span> <span class="nx">dataSource</span><span class="p">.</span><span class="nx">cloneWithRows</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">listings</span><span class="p">)</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="nx">renderRow</span><span class="p">(</span><span class="nx">rowData</span><span class="p">,</span> <span class="nx">sectionID</span><span class="p">,</span> <span class="nx">rowID</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">TouchableHighlight</span>
          <span class="nx">underlayColor</span><span class="o">=</span><span class="s1">'#dddddd'</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">View</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">Text</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">rowData</span><span class="p">.</span><span class="nx">title</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/Text&gt;</span>
        <span class="o">&lt;</span><span class="err">/View&gt;</span>
      <span class="o">&lt;</span><span class="err">/TouchableHighlight&gt;</span>
    <span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">ListView</span>
        <span class="nx">dataSource</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">dataSource</span><span class="p">}</span>
        <span class="nx">renderRow</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">renderRow</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)}</span><span class="o">/&gt;</span>
    <span class="p">);</span>
  <span class="p">}</span>

<span class="p">}</span>
</code></pre></div><p>上述的代码里用到了一个特定的组件 – ListView – 它能将数据一行行地呈现出来，并放置在一个可滚动的容器内，和 UITableView 很相似。通过 ListView.DataSource 将 ListView 的数据引入，还有一个函数来显示每一行UI。</p><p>在构建数据源的同时，你还需要一个函数用来比较每两行之间是否重复。 为了确认列表数据的变化，在 reconciliation 过程中ListView 就会使用到这个函数。在这个实例中，由 Nestoria API 返回的房屋数据都有一个guid 属性，它就是用来测试数据变化的。</p><p>现在将模块导出的代码添加至文件末尾：</p><div class="highlight"><pre><code class="language-js"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">SearchResults</span><span class="p">;</span>
</code></pre></div><p>将下面这段代码加到 <strong>SearchPage.js</strong> 较前的位置，不过要在 require 语句的后面哦：</p><div class="highlight"><pre><code class="language-js"><span class="kd">var</span> <span class="nx">SearchResults</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'./SearchResults'</span><span class="p">);</span>
</code></pre></div><p>这样我们就能在 SearchPage 类中使用刚刚加上的 SearchResults 类。</p><p>还要把 _handleResponse 方法中的 console.log 语句改成下面这样：</p><div class="highlight"><pre><code class="language-js"><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
  <span class="nx">title</span><span class="o">:</span> <span class="s1">'Results'</span><span class="p">,</span>
  <span class="nx">component</span><span class="o">:</span> <span class="nx">SearchResults</span><span class="p">,</span>
  <span class="nx">passProps</span><span class="o">:</span> <span class="p">{</span><span class="nx">listings</span><span class="o">:</span> <span class="nx">response</span><span class="p">.</span><span class="nx">listings</span><span class="p">}</span>
<span class="p">});</span>
</code></pre></div><p>SearchResults 组件通过上面的代码传入列表里。在这里用的是 push方法确保搜索结果全部推进导航栈中，这样你就可以通过 ‘Back’ 按钮返回到根页面。</p><p>回到模拟器，按下 Cmd+R 刷新页面，然后试试看我们的搜索。估计你会得到类似下面这样的结果：</p><img src="./深入浅出 React Native：使用 JavaScript 构建原生应用 - 前端外刊评论 - 知乎专栏_files/c23812701c4ff54163cf2978e28ebb50_b.jpg" data-rawwidth="281" data-rawheight="500" class="content_image" width="281"><p>耶！你的搜索实现了呢，不过这搜索结果页面的颜值也太低了，不要担心，接下来给它化化妆。</p><br><h2>可点击样式</h2><p>这些 React Native 的原生代码现在应该理解起来轻车熟路了,所以本教程将会加快速度。</p><p>在 SearchResults.js 中，destructuring 声明后面添加以下语句来定义样式：</p><div class="highlight"><pre><code class="language-js"><span class="kd">var</span> <span class="nx">styles</span> <span class="o">=</span> <span class="nx">StyleSheet</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
  <span class="nx">thumb</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">width</span><span class="o">:</span> <span class="mi">80</span><span class="p">,</span>
    <span class="nx">height</span><span class="o">:</span> <span class="mi">80</span><span class="p">,</span>
    <span class="nx">marginRight</span><span class="o">:</span> <span class="mi">10</span>
  <span class="p">},</span>
  <span class="nx">textContainer</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">flex</span><span class="o">:</span> <span class="mi">1</span>
  <span class="p">},</span>
  <span class="nx">separator</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">height</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">backgroundColor</span><span class="o">:</span> <span class="s1">'#dddddd'</span>
  <span class="p">},</span>
  <span class="nx">price</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">fontSize</span><span class="o">:</span> <span class="mi">25</span><span class="p">,</span>
    <span class="nx">fontWeight</span><span class="o">:</span> <span class="s1">'bold'</span><span class="p">,</span>
    <span class="nx">color</span><span class="o">:</span> <span class="s1">'#48BBEC'</span>
  <span class="p">},</span>
  <span class="nx">title</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">fontSize</span><span class="o">:</span> <span class="mi">20</span><span class="p">,</span>
    <span class="nx">color</span><span class="o">:</span> <span class="s1">'#656565'</span>
  <span class="p">},</span>
  <span class="nx">rowContainer</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">flexDirection</span><span class="o">:</span> <span class="s1">'row'</span><span class="p">,</span>
    <span class="nx">padding</span><span class="o">:</span> <span class="mi">10</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div><p>这些定义了每一行的样式。</p><p>接下来修改 renderRow() 如下:</p><div class="highlight"><pre><code class="language-js"><span class="nx">renderRow</span><span class="p">(</span><span class="nx">rowData</span><span class="p">,</span> <span class="nx">sectionID</span><span class="p">,</span> <span class="nx">rowID</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">price</span> <span class="o">=</span> <span class="nx">rowData</span><span class="p">.</span><span class="nx">price_formatted</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">' '</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">TouchableHighlight</span> <span class="nx">onPress</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">rowPressed</span><span class="p">(</span><span class="nx">rowData</span><span class="p">.</span><span class="nx">guid</span><span class="p">)}</span>
        <span class="nx">underlayColor</span><span class="o">=</span><span class="s1">'#dddddd'</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">View</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">View</span> <span class="nx">style</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">rowContainer</span><span class="p">}</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">Image</span> <span class="nx">style</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">thumb</span><span class="p">}</span> <span class="nx">source</span><span class="o">=</span><span class="p">{{</span> <span class="nx">uri</span><span class="o">:</span> <span class="nx">rowData</span><span class="p">.</span><span class="nx">img_url</span> <span class="p">}}</span> <span class="o">/&gt;</span>
          <span class="o">&lt;</span><span class="nx">View</span>  <span class="nx">style</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">textContainer</span><span class="p">}</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">Text</span> <span class="nx">style</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">price</span><span class="p">}</span><span class="o">&gt;</span><span class="err">£</span><span class="p">{</span><span class="nx">price</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/Text&gt;</span>
            <span class="o">&lt;</span><span class="nx">Text</span> <span class="nx">style</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">title</span><span class="p">}</span> 
                  <span class="nx">numberOfLines</span><span class="o">=</span><span class="p">{</span><span class="mi">1</span><span class="p">}</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">rowData</span><span class="p">.</span><span class="nx">title</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/Text&gt;</span>
          <span class="o">&lt;</span><span class="err">/View&gt;</span>
        <span class="o">&lt;</span><span class="err">/View&gt;</span>
        <span class="o">&lt;</span><span class="nx">View</span> <span class="nx">style</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">separator</span><span class="p">}</span><span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="err">/View&gt;</span>
    <span class="o">&lt;</span><span class="err">/TouchableHighlight&gt;</span>
  <span class="p">);</span>
<span class="p">}</span>
</code></pre></div><p>这个操作修改了返回的价格,将已经格式了化的”300000 GBP”中的GBP后缀删除。然后它通过你已经很熟悉的技术来渲染每一行的 UI 。这一次,通过一个 URL 来提供缩略图的数据, React Native 负责在主线程之外解码这些数据。</p><p>同时要注意 TouchableHighlight 组件中 onPress属性后使用的箭头函数；它用于捕获每一行的 guid。</p><p>最后一步，给类添加一个方法来处理按下操作:</p><div class="highlight"><pre><code class="language-js"><span class="nx">rowPressed</span><span class="p">(</span><span class="nx">propertyGuid</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">property</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">listings</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">prop</span> <span class="o">=&gt;</span> <span class="nx">prop</span><span class="p">.</span><span class="nx">guid</span> <span class="o">===</span> <span class="nx">propertyGuid</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></div><p>该方法通过用户触发的属性来定位。目前该方法没有做任何事，你可以稍后处理。现在，是时候欣赏你的大作了。</p><p>回到模拟器,按下 Cmd + R 查看结果:</p><img src="./深入浅出 React Native：使用 JavaScript 构建原生应用 - 前端外刊评论 - 知乎专栏_files/1d29bb1920622180d5ae03c64440b664_b.jpg" data-rawwidth="281" data-rawheight="500" class="content_image" width="281"><p>看起来好多了——尽管你会怀疑是否任何人都能承受住在伦敦的代价!</p><p>是时候向应用程序添加最后一个视图了。</p><br><h2>房产详情视图</h2><p>添加一个新的文件 PropertyView.js 到项目中，在文件的顶部添加如下代码：</p><div class="highlight"><pre><code class="language-js"><span class="s1">'use strict'</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">React</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'react-native'</span><span class="p">);</span>
<span class="kd">var</span> <span class="p">{</span>
  <span class="nx">StyleSheet</span><span class="p">,</span>
  <span class="nx">Image</span><span class="p">,</span> 
  <span class="nx">View</span><span class="p">,</span>
  <span class="nx">Text</span><span class="p">,</span>
  <span class="nx">Component</span>
<span class="p">}</span> <span class="o">=</span> <span class="nx">React</span><span class="p">;</span>
</code></pre></div><p>信手拈来了吧！</p><p>接着添加如下样式：</p><div class="highlight"><pre><code class="language-js"><span class="kd">var</span> <span class="nx">styles</span> <span class="o">=</span> <span class="nx">StyleSheet</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
  <span class="nx">container</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">marginTop</span><span class="o">:</span> <span class="mi">65</span>
  <span class="p">},</span>
  <span class="nx">heading</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">backgroundColor</span><span class="o">:</span> <span class="s1">'#F8F8F8'</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="nx">separator</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">height</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">backgroundColor</span><span class="o">:</span> <span class="s1">'#DDDDDD'</span>
  <span class="p">},</span>
  <span class="nx">image</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">width</span><span class="o">:</span> <span class="mi">400</span><span class="p">,</span>
    <span class="nx">height</span><span class="o">:</span> <span class="mi">300</span>
  <span class="p">},</span>
  <span class="nx">price</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">fontSize</span><span class="o">:</span> <span class="mi">25</span><span class="p">,</span>
    <span class="nx">fontWeight</span><span class="o">:</span> <span class="s1">'bold'</span><span class="p">,</span>
    <span class="nx">margin</span><span class="o">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="nx">color</span><span class="o">:</span> <span class="s1">'#48BBEC'</span>
  <span class="p">},</span>
  <span class="nx">title</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">fontSize</span><span class="o">:</span> <span class="mi">20</span><span class="p">,</span>
    <span class="nx">margin</span><span class="o">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="nx">color</span><span class="o">:</span> <span class="s1">'#656565'</span>
  <span class="p">},</span>
  <span class="nx">description</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">fontSize</span><span class="o">:</span> <span class="mi">18</span><span class="p">,</span>
    <span class="nx">margin</span><span class="o">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="nx">color</span><span class="o">:</span> <span class="s1">'#656565'</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div><p>然后加上组件本身：</p><div class="highlight"><pre><code class="language-js"><span class="kr">class</span> <span class="nx">PropertyView</span> <span class="kr">extends</span> <span class="nx">Component</span> <span class="p">{</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">property</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">property</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">stats</span> <span class="o">=</span> <span class="nx">property</span><span class="p">.</span><span class="nx">bedroom_number</span> <span class="o">+</span> <span class="s1">' bed '</span> <span class="o">+</span> <span class="nx">property</span><span class="p">.</span><span class="nx">property_type</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">property</span><span class="p">.</span><span class="nx">bathroom_number</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">stats</span> <span class="o">+=</span> <span class="s1">', '</span> <span class="o">+</span> <span class="nx">property</span><span class="p">.</span><span class="nx">bathroom_number</span> <span class="o">+</span> <span class="s1">' '</span> <span class="o">+</span> <span class="p">(</span><span class="nx">property</span><span class="p">.</span><span class="nx">bathroom_number</span> <span class="o">&gt;</span> <span class="mi">1</span>
        <span class="o">?</span> <span class="s1">'bathrooms'</span> <span class="o">:</span> <span class="s1">'bathroom'</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">price</span> <span class="o">=</span> <span class="nx">property</span><span class="p">.</span><span class="nx">price_formatted</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">' '</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>

    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">View</span> <span class="nx">style</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">container</span><span class="p">}</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">Image</span> <span class="nx">style</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">image</span><span class="p">}</span> 
            <span class="nx">source</span><span class="o">=</span><span class="p">{{</span><span class="nx">uri</span><span class="o">:</span> <span class="nx">property</span><span class="p">.</span><span class="nx">img_url</span><span class="p">}}</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="nx">View</span> <span class="nx">style</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">heading</span><span class="p">}</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">Text</span> <span class="nx">style</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">price</span><span class="p">}</span><span class="o">&gt;</span><span class="err">£</span><span class="p">{</span><span class="nx">price</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/Text&gt;</span>
          <span class="o">&lt;</span><span class="nx">Text</span> <span class="nx">style</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">title</span><span class="p">}</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">property</span><span class="p">.</span><span class="nx">title</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/Text&gt;</span>
          <span class="o">&lt;</span><span class="nx">View</span> <span class="nx">style</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">separator</span><span class="p">}</span><span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="err">/View&gt;</span>
        <span class="o">&lt;</span><span class="nx">Text</span> <span class="nx">style</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">description</span><span class="p">}</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">stats</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/Text&gt;</span>
        <span class="o">&lt;</span><span class="nx">Text</span> <span class="nx">style</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">description</span><span class="p">}</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">property</span><span class="p">.</span><span class="nx">summary</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/Text&gt;</span>
      <span class="o">&lt;</span><span class="err">/View&gt;</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>render() 前面部分对数据进行了处理，与通常的情况一样，API 返回的数据良莠不齐，往往有些字段是缺失的。这段代码通过一些简单的逻辑，让数据更加地规整一些。</p><p>render 剩余的部分就非常直接了。它就是一个简单的这个状态不可变状态的函数。</p><p>最后在文件的末尾加上如下的 export：</p><div class="highlight"><pre><code class="language-text">module.exports = PropertyView;
</code></pre></div><p>返回到 SearchResults.js 文件，在顶部，require React 的下面，添加一个新的 require 语句。</p><div class="highlight"><pre><code class="language-text">var PropertyView = require('./PropertyView');
</code></pre></div><p>接下来更新 rowPassed()，添加跳转到新加入的 PropertyView：</p><div class="highlight"><pre><code class="language-js"><span class="nx">rowPressed</span><span class="p">(</span><span class="nx">propertyGuid</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">property</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">listings</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">prop</span> <span class="o">=&gt;</span> <span class="nx">prop</span><span class="p">.</span><span class="nx">guid</span> <span class="o">===</span> <span class="nx">propertyGuid</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
    <span class="nx">title</span><span class="o">:</span> <span class="s2">"Property"</span><span class="p">,</span>
    <span class="nx">component</span><span class="o">:</span> <span class="nx">PropertyView</span><span class="p">,</span>
    <span class="nx">passProps</span><span class="o">:</span> <span class="p">{</span><span class="nx">property</span><span class="o">:</span> <span class="nx">property</span><span class="p">}</span>
  <span class="p">});</span>
<span class="p">}</span>
</code></pre></div><p>你知道的：回到模拟器，Cmd + R，一路通过搜索点击一行到房产详情界面：</p><img src="./深入浅出 React Native：使用 JavaScript 构建原生应用 - 前端外刊评论 - 知乎专栏_files/d69b23ae9ede0ceda01a302ce146e091_b.jpg" data-rawwidth="281" data-rawheight="500" class="content_image" width="281">物廉价美——看上去很不错哦！<p>应用即将完成，最后一步是允许用户搜索附近的房产。</p><br><h2>地理位置搜索</h2><p>在 Xcode 中，打开 Info.plist 添加一个新的 key，在编辑器内部单击鼠标右键并且选择 <strong>Add Row</strong>。使用NSLocationWhenInUseUsageDescription 作为 key 名并且使用下面的值：</p><div class="highlight"><pre><code class="language-text">PropertyFinder would like to use your location to find nearby properties
</code></pre></div><p>下面是当你添加了新的 key 后，所得到的属性列表：</p><p>你将把这个关键的细节提示呈现给用户，方便他们请求访问当前位置。</p><p>打开 SearchPage.js，找到用于渲染 Location 按钮的TouchableHighlight，然后为其添加下面的属性值：</p><div class="highlight"><pre><code class="language-js"><span class="nx">onPress</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">onLocationPressed</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)}</span>
</code></pre></div><p>当你用手指轻点这个按钮，会调用 onLocationPressed —— 接下来会定义这个方法。</p><p>将下面的代码添加到 SearchPage 类中：</p><div class="highlight"><pre><code class="language-js"><span class="nx">onLocationPressed</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">navigator</span><span class="p">.</span><span class="nx">geolocation</span><span class="p">.</span><span class="nx">getCurrentPosition</span><span class="p">(</span>
    <span class="nx">location</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">search</span> <span class="o">=</span> <span class="nx">location</span><span class="p">.</span><span class="nx">coords</span><span class="p">.</span><span class="nx">latitude</span> <span class="o">+</span> <span class="s1">','</span> <span class="o">+</span> <span class="nx">location</span><span class="p">.</span><span class="nx">coords</span><span class="p">.</span><span class="nx">longitude</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="nx">searchString</span><span class="o">:</span> <span class="nx">search</span> <span class="p">});</span>
      <span class="kd">var</span> <span class="nx">query</span> <span class="o">=</span> <span class="nx">urlForQueryAndPage</span><span class="p">(</span><span class="s1">'centre_point'</span><span class="p">,</span> <span class="nx">search</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_executeQuery</span><span class="p">(</span><span class="nx">query</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">error</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
        <span class="nx">message</span><span class="o">:</span> <span class="s1">'There was a problem with obtaining your location: '</span> <span class="o">+</span> <span class="nx">error</span>
      <span class="p">});</span>
    <span class="p">});</span>
<span class="p">}</span>
</code></pre></div><p>通过 navigator.geolocation 检索当前位置；这是一个 <a href="https://developer.mozilla.org/en-US/docs/Web/API/Geolocation/Using_geolocation" class=" wrap external" target="_blank" rel="nofollow noreferrer">Web API 所定义的<i class="icon-external"></i></a>接口，所以对于每个在浏览器中使用 location 服务的用户来说这个接口都应该是一致的。React Native 框架借助原生的 iOS location 服务提供了自身的 API 实现。</p><p>如果当前位置很容易获取到，你将调用第一个箭头函数；这会向Nestoria 发送一个 query。如果出现错误则会得到一个基本的出错信息。</p><p>因为你已经改变了属性列表，你需要重新启动这个应用以看到更改。抱歉，这次不可以 Cmd+R。请中断 Xcode 中的应用，然后创建和运行项目。</p><p>在使用基于位置的搜索前，你需要指定一个被 Nestoria 数据库覆盖的位置。在模拟器菜单中，选择 Debug\Location\Custom Location … 然后输入 55.02 维度和 -1.42 经度，这个坐标是英格兰北部的一个景色优美的海边小镇，我经常在那给家里打电话。</p><img src="./深入浅出 React Native：使用 JavaScript 构建原生应用 - 前端外刊评论 - 知乎专栏_files/55ccd1213bb3d057685335156f7b7ccd_b.jpg" data-rawwidth="647" data-rawheight="500" class="origin_image zh-lightbox-thumb" width="647" data-original="http://pic1.zhimg.com/55ccd1213bb3d057685335156f7b7ccd_r.jpg"><blockquote><p>警示：我们可以正常地使用位置搜索功能，不过可能有部分同学不能使用（在访问时返回 access denied 错误）—— 我们尚不确定其原因，可能是 React Native 的问题？如果谁遇到了同样的问题并且已经结果，烦请告诉我们。这里没有伦敦那样值得炫耀 —— 不过更加经济！:]</p></blockquote><h2>下一步行动？</h2><p>完成了第一个 React Native 应用呢，恭喜你！你可以<a href="https://github.com/ColinEberhardt/ReactNative-PropertyFinder" class=" wrap external" target="_blank" rel="nofollow noreferrer">下载本教程的完整代码<i class="icon-external"></i></a>，亲自来试试看。</p><p>如果已经接触过 Web 开发了，你会发现使用 JavaScript 和 React 来定义与原生 UI 相连接的接口和导航是多么地容易。而如果你曾经开发过原生 App，我相信在使用 React Native 的过程里你会感受到它种种好处：快速的应用迭代，JavaScript 的引入以及清晰地使用 CSS 定义样式。</p><p>也许下次做 App 的时候，你可以试试这个框架？或者说，你依然坚持使用 Swift 或者 Objective-C？无论之后你的选择是怎么样的，我都希望读完这篇文章的你有所收获，还能把这些收获融入到你的项目当中是最好的啦。</p><p>如果你对这篇教程有任何疑问，请在<a href="http://www.raywenderlich.com/99473/introducing-react-native-building-apps-javascript" class=" wrap external" target="_blank" rel="nofollow noreferrer">这篇文章<i class="icon-external"></i></a>的讨论区留言！</p><br><p>原文：<a href="http://www.raywenderlich.com/99473/introducing-react-native-building-apps-javascript" class=" wrap external" target="_blank" rel="nofollow noreferrer">Introducing React Native: Building Apps with JavaScript<i class="icon-external"></i></a></p><br><br><p>外刊君推荐</p><p>1. <a href="http://wiki.jikexueyuan.com/project/react-native/" class=" wrap external" target="_blank" rel="nofollow noreferrer">Facebook React Native 中文教程<i class="icon-external"></i></a></p><img src="./深入浅出 React Native：使用 JavaScript 构建原生应用 - 前端外刊评论 - 知乎专栏_files/0c4fe5e5b4498114c398ea2bf530506b_b.jpg" data-rawwidth="600" data-rawheight="320" class="origin_image zh-lightbox-thumb" width="600" data-original="http://pic2.zhimg.com/0c4fe5e5b4498114c398ea2bf530506b_r.jpg"><br><p>关注微博：<a href="http://weibo.com/u/5368192199" class=" wrap external" target="_blank" rel="nofollow noreferrer">前端外刊评论<i class="icon-external"></i></a></p></section>

    <footer>
      <div class="entry-controls clearfix">
        <div class="right-section">
          <!-- <span class="control-item read-counts">
            <i class="icon icon-eye"></i>13 人读过
          </span> -->
          <!-- ngIf: !isCensoring --><div ng-transclude="" class="post-share-button post-menu-button ui-menu-button ng-scope" ng-class="{ true: &#39;open&#39;, false: &#39;close&#39; }[open]" ui-menu-button="" onbeforeopen="beforeShareMenuOpen()" ng-if="!isCensoring">
            <a href="javascript:;" class="menu-button control-item share ng-scope"><i class="icon icon-share"></i>分享</a>
            <menu class="menu ng-scope" tabindex="0">
              <!-- ngRepeat: item in shareMenuItems --><div ng-click="item.action()" class="menu-item ng-binding ng-scope" ng-repeat="item in shareMenuItems" tabindex="0">
                <i class="icon icon-share-sina"></i>新浪微博
              </div><!-- end ngRepeat: item in shareMenuItems --><div ng-click="item.action()" class="menu-item ng-binding ng-scope" ng-repeat="item in shareMenuItems" tabindex="0">
                <i class="icon icon-share-qq"></i>腾讯微博
              </div><!-- end ngRepeat: item in shareMenuItems --><div ng-click="item.action()" class="menu-item ng-binding ng-scope" ng-repeat="item in shareMenuItems" tabindex="0">
                <i class="icon icon-share-twitter"></i>Twitter
              </div><!-- end ngRepeat: item in shareMenuItems --><div ng-click="item.action()" class="menu-item ng-binding ng-scope" ng-repeat="item in shareMenuItems" tabindex="0">
                <i class="icon icon-share-douban"></i>豆瓣
              </div><!-- end ngRepeat: item in shareMenuItems -->
            </menu>
          </div><!-- end ngIf: !isCensoring -->

          <!-- ngIf: ownPost(post) -->

          <div ng-transclude="" class="post-options-button post-menu-button ui-menu-button ng-scope ng-hide" ng-class="{ true: &#39;open&#39;, false: &#39;close&#39; }[open]" ng-show="ownPost(post)" ui-menu-button="">
            <a href="javascript:;" class="menu-button control-item options ng-scope">
              <i class="icon icon-settings"></i><span class="hide-text">设置</span>
            </a>
            <menu class="menu ng-scope" tabindex="0">
              <div ng-click="removePost()" class="menu-item" tabindex="0"><i class="icon icon-del-big"></i>删除</div>
            </menu>
          </div>

          <!-- ngIf: !ownPost(post) && !isCensoring --><a ng-if="!ownPost(post) &amp;&amp; !isCensoring" ng-click="report(post)" href="javascript:;" class="control-item report ng-scope"><i class="icon icon-comment-report"></i>举报</a><!-- end ngIf: !ownPost(post) && !isCensoring -->

        </div>

        <!-- ngIf: !isCensoring --><div class="left-section ng-scope" ng-if="!isCensoring">
          <div class="vote-section-wrapper clearfix">
            <span class="vote-section" ng-show="!ownPost(post)">
              <a ng-click="post.toggleLike()" href="javascript:;" class="voteup ng-binding" ng-class="{ active: post.rating == &#39;like&#39; }"><i class="icon icon-voteup"></i>276 赞</a>
              <a ng-click="post.toggleDislike()" href="javascript:;" class="votedown" ng-class="{ active: post.rating == &#39;dislike&#39; }"><i class="icon icon-votedown"></i></a>
            </span>
            <span class="vote-num ng-binding ng-hide" ng-show="ownPost(post)">276 赞</span>
          </div>

          <!-- ngIf: post.lastestLikers.length && !likers --><div class="voters clearfix ng-scope" ng-if="post.lastestLikers.length &amp;&amp; !likers">
            <!-- ngRepeat: user in post.lastestLikers --><a href="http://www.zhihu.com/people/sha-yan-62-40" target="_blank" title="sha yan" class="voter ng-scope" ng-repeat="user in post.lastestLikers">
              <img ng-src="http://pic3.zhimg.com/da8e974dc_s.jpg" alt="sha yan" class="avatar-small" src="./深入浅出 React Native：使用 JavaScript 构建原生应用 - 前端外刊评论 - 知乎专栏_files/da8e974dc_s.jpg">
            </a><!-- end ngRepeat: user in post.lastestLikers --><a href="http://www.zhihu.com/people/bit-king" target="_blank" title="Bit King" class="voter ng-scope" ng-repeat="user in post.lastestLikers">
              <img ng-src="http://pic1.zhimg.com/c36a4ec4e_s.jpg" alt="Bit King" class="avatar-small" src="./深入浅出 React Native：使用 JavaScript 构建原生应用 - 前端外刊评论 - 知乎专栏_files/c36a4ec4e_s.jpg">
            </a><!-- end ngRepeat: user in post.lastestLikers --><a href="http://www.zhihu.com/people/wei-sha-huan-yao-zhu-ce" target="_blank" title="为啥还要注册" class="voter ng-scope" ng-repeat="user in post.lastestLikers">
              <img ng-src="http://pic3.zhimg.com/e0c94509c_s.jpg" alt="为啥还要注册" class="avatar-small" src="./深入浅出 React Native：使用 JavaScript 构建原生应用 - 前端外刊评论 - 知乎专栏_files/e0c94509c_s.jpg">
            </a><!-- end ngRepeat: user in post.lastestLikers --><a href="http://www.zhihu.com/people/lin-kun-xian" target="_blank" title="林坤贤" class="voter ng-scope" ng-repeat="user in post.lastestLikers">
              <img ng-src="http://pic3.zhimg.com/fad2a2fa5_s.jpg" alt="林坤贤" class="avatar-small" src="./深入浅出 React Native：使用 JavaScript 构建原生应用 - 前端外刊评论 - 知乎专栏_files/fad2a2fa5_s.jpg">
            </a><!-- end ngRepeat: user in post.lastestLikers --><a href="http://www.zhihu.com/people/a-li-de-meng" target="_blank" title="阿狸的梦" class="voter ng-scope" ng-repeat="user in post.lastestLikers">
              <img ng-src="http://pic3.zhimg.com/5163f871d_s.jpg" alt="阿狸的梦" class="avatar-small" src="./深入浅出 React Native：使用 JavaScript 构建原生应用 - 前端外刊评论 - 知乎专栏_files/5163f871d_s.jpg">
            </a><!-- end ngRepeat: user in post.lastestLikers -->
            <!-- ngIf: post.lastestLikers.length < post.likesCount && !fetchLikersPending --><a href="javascript:;" title="查看全部" class="more-voters ng-scope" ng-click="fetchAllLikers()" ng-if="post.lastestLikers.length &lt; post.likesCount &amp;&amp; !fetchLikersPending">
              <i class="icon icon-more-voters"></i>
            </a><!-- end ngIf: post.lastestLikers.length < post.likesCount && !fetchLikersPending -->
            <!-- ngIf: fetchLikersPending -->
          </div><!-- end ngIf: post.lastestLikers.length && !likers -->

          <!-- ngIf: likers -->
        </div><!-- end ngIf: !isCensoring -->

      </div>

      <!-- <a ng-click="collect(post)" href="javascript:;" class="collect"><i class="icon icon-collect"></i>收藏</a> -->

      <!-- ngIf: post.meta.previous || post.meta.next --><div class="posts-navigator ng-scope" ng-if="post.meta.previous || post.meta.next">
        <div class="posts-nav" ng-class="{one: !post.meta.previous || !post.meta.next}">
          <a class="prev post-link" href="http://zhuanlan.zhihu.com/FrontendMagazine/19978387" ng-show="post.meta.previous">
            <i class="icon icon-prev-post"></i>
            <strong class="title ng-binding">Flexbox 设计指南2：垂直布局</strong>
          </a>
          <a class="next post-link" href="http://zhuanlan.zhihu.com/FrontendMagazine/20002850" ng-show="post.meta.next">
            <i class="icon icon-next-post"></i>
            <strong class="title ng-binding">2015 前端[JS]工程师必知必会</strong>
          </a>
        </div>
      </div><!-- end ngIf: post.meta.previous || post.meta.next -->

      <!-- ngIf: !isCensoring --><div class="entry-comments comment-box ng-isolate-scope empty" ng-show="expanded" ng-class="{ empty: !pending &amp;&amp; !comments.length }" ng-switch="pending" ng-init="warningMessageShow = !status.canComment &amp;&amp; status.permission != &#39;anyone&#39;" id="comments" ui-post-comments="" comments-href="post.links.comments" comments-expanded="true" comments-post-owner="post.author" comments-status="commentsStatus" ng-if="!isCensoring">

  <div class="box-header">
    <span class="counter">
      <i class="icon icon-comment"></i><span class="ng-binding">68 条评论</span>
    </span>
    <a href="http://zhuanlan.zhihu.com/FrontendMagazine/settings#permission" class="comment-options ng-hide" ng-show="$parent.column.creator.slug == me.slug" title="评论设置">
      <i class="icon icon-settings"></i>
    </a>
  </div>

  <!-- ngSwitchWhen: true -->

  <!-- ngSwitchWhen: false --><div ng-switch-when="false" class="ng-scope">

    <ul class="comment-list">
      <!-- ngRepeat: comment in comments | orderBy:'id' track by comment.id -->
    </ul>

    <!-- ngIf: !source.completed -->

    <!-- ngIf: warningMessageShow -->

    <!-- ngIf: !warningMessageShow --><form class="comment-form comment-box-ft ng-scope ng-invalid ng-invalid-content-required ng-dirty" ng-class="{ &#39;expanded&#39;: formExpanded }" name="commentForm" ng-if="!warningMessageShow">
      <!-- ngIf: me.authed() --><img class="avatar ng-scope" ng-src="http://pic1.zhimg.com/da8e974dc_xs.jpg" ng-if="me.authed()" src="./深入浅出 React Native：使用 JavaScript 构建原生应用 - 前端外刊评论 - 知乎专栏_files/da8e974dc_xs.jpg"><!-- end ngIf: me.authed() -->
      <div class="editable ng-invalid ng-invalid-content-required ng-dirty" ui-scraper="" scraper-options="scraperOptions" ui-mention="" ui-clean-paste="" ui-events="{focus:&#39;expandForm(true)&#39;}" ui-ctrl-enter="addComment()" contenteditable="true" content-required="" ng-model="editingComment.content" holdertext="写下你的评论…" name="content"><span class="holdertext" holdertext="1" contenteditable="false">写下你的评论…</span></div>
      <!-- ngIf: me.authed() --><div class="command clearfix ng-scope" ng-if="me.authed()">
        <button ng-disabled="savePending" ng-click="addComment()" class="save btn-blue">评论</button>
        <button ng-click="expandForm(false, $event)" class="cancel btn-link">取消</button>
      </div><!-- end ngIf: me.authed() -->
    </form><!-- end ngIf: !warningMessageShow -->

  </div>

</div><!-- end ngIf: !isCensoring -->
    </footer>
  <div ng-show="zoomed" ng-animate="{show: &#39;in&#39;, hide: &#39;out&#39;}" class="lightbox-overlay ng-scope ng-hide"></div></article>

  <aside class="sidebar">

    <div class="block column-about">
      <a href="http://zhuanlan.zhihu.com/FrontendMagazine" class="avatar-link">
        <img class="avatar-big" ng-src="http://pic4.zhimg.com/dda3a699e_l.jpg" src="./深入浅出 React Native：使用 JavaScript 构建原生应用 - 前端外刊评论 - 知乎专栏_files/dda3a699e_l.jpg">
      </a>
      <a href="http://zhuanlan.zhihu.com/FrontendMagazine" class="title ng-binding">前端外刊评论</a>
      <!-- ngIf: column.creator.slug == me.slug -->
      <div class="followers" ng-switch="" on="!!column.followersCount">
        <!-- ngSwitchWhen: true --><a ng-switch-when="true" href="http://zhuanlan.zhihu.com/FrontendMagazine/followers" class="ng-binding ng-scope">8064 人关注</a>
        <!-- ngSwitchWhen: false -->
      </div>
      <div class="description ng-binding" ng-bind-html="column.description | linky">Ω  

关注前端前沿技术，探寻业界深邃思想

欢迎给本专栏投稿，原作译作不限，要求只有一个：质量高！

提供前端技术培训、前端架构咨询或实施服务！

如果愿意尝试从事前端技术相关的书籍的翻译工作，也可以私信我。</div>
    </div>

    <div class="block rel-topics ng-hide" ng-show="!isCensoring &amp;&amp; (post.topics.length || ownPost(post))">
      <!-- ngIf: post.topics.length -->
      <!-- ngIf: ownPost(post) -->
    </div>

  </aside>

</div>
</main>

    <div class="modal-dialog-bg" style="display: none; opacity: 0.5;"></div><div class="modal-dialog columns-selector ng-isolate-scope " ui-dialog="" tabindex="-1" open="show" data-show="navColumnsSelectorShow" data-href="me.links.columns" data-title="我的专栏" ui-columns-selector="" onselect="navToColumn(column)" aria-labelledby=":0" role="dialog" style="display: none;">
  <div class="modal-dialog-title modal-dialog-title-draggable" id=":0">
    <span class="modal-dialog-title-text ng-binding">我的专栏</span>
    <span class="modal-dialog-title-close"></span>
  </div>

  <div class="modal-dialog-content">
    <div class="column-list ng-hide" ng-show="columns.length">
        <!-- ngRepeat: column in columns -->
        <!-- ngIf: mode != 'selectonly' --><a href="javascript:;" ng-click="create()" class="column-item create-column ng-scope" ng-if="mode != &#39;selectonly&#39;">
          <i class="icon icon-create-column"></i>
          <div class="text">创建专栏</div>
          <i class="icon icon-go"></i>
        </a><!-- end ngIf: mode != 'selectonly' -->
    </div>
  </div>
<div class="modal-dialog-buttons"></div></div><span tabindex="0" style="display: none; position: absolute;"></span>

    <div class="modal-dialog-bg" style="display: none; opacity: 0.5;"></div><div class="modal-dialog columns-selector ng-isolate-scope " ui-dialog="" tabindex="-1" open="show" data-show="writeColumnsSelectorShow" data-href="me.links.columns" data-title="请选择一个专栏" ui-columns-selector="" onselect="writePostFor(column)" aria-labelledby=":1" role="dialog" style="display: none;">
  <div class="modal-dialog-title modal-dialog-title-draggable" id=":1">
    <span class="modal-dialog-title-text ng-binding">请选择一个专栏</span>
    <span class="modal-dialog-title-close"></span>
  </div>

  <div class="modal-dialog-content">
    <div class="column-list ng-hide" ng-show="columns.length">
        <!-- ngRepeat: column in columns -->
        <!-- ngIf: mode != 'selectonly' --><a href="javascript:;" ng-click="create()" class="column-item create-column ng-scope" ng-if="mode != &#39;selectonly&#39;">
          <i class="icon icon-create-column"></i>
          <div class="text">创建专栏</div>
          <i class="icon icon-go"></i>
        </a><!-- end ngIf: mode != 'selectonly' -->
    </div>
  </div>
<div class="modal-dialog-buttons"></div></div><span tabindex="0" style="display: none; position: absolute;"></span>

    <script src="./深入浅出 React Native：使用 JavaScript 构建原生应用 - 前端外刊评论 - 知乎专栏_files/812da43d.angular.all.js"></script>

    
    <script src="./深入浅出 React Native：使用 JavaScript 构建原生应用 - 前端外刊评论 - 知乎专栏_files/55b0cba8.compiled.js"></script>
    
    <script src="./深入浅出 React Native：使用 JavaScript 构建原生应用 - 前端外刊评论 - 知乎专栏_files/42e39560.scripts.js"></script>

    <script>
      var _gaq=[
        ['_setAccount','UA-20961733-1'],
        ['_setDomainName', 'zhihu.com'],
        ['_trackPageview']
      ];
      window.onload=function(){/no-js/.test(document.documentElement.className)&&_gaq.push(['_trackEvent','columnwebapp','pageblank'])};
      (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
      g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';g.async=1;
      s.parentNode.insertBefore(g,s)}(document,'script'));
    </script>

  

<!-- Begin Templates -->
<script type="text/ng-template" id="/scripts/auth/dialog-activate.html">
<div class="modal-dialog activate-dialog">
  <div class="modal-dialog-title">
    <span class="modal-dialog-title-text">激活帐号</span>
    <span class="modal-dialog-title-close"></span>
  </div>

  <div class="modal-dialog-content">
    <div class="activate-form">
      <p class="message">为了正常使用知乎专栏，请前往您的邮箱激活帐号。</p>
      <p class="center">
        <a href="http://{{ me.email.split('@').slice(-1)[0] }}" class="btn-blue">前往邮箱</a>
      </p>
      <hr>
      <p class="actions">
        <span class="mute">您的邮箱：{{ me.email }}</span>
        <a href="{{ accountSettingsUrl }}">修改</a>
        <ng-switch on="sent">
          <a ng-switch-when="false" href="#" ng-click="resend($event)">重新发送激活邮件</a>
          <span ng-switch-when="true" class="mute">已发送
        </span></ng-switch>
      </p>
    </div>
  </div>
</div>
</script>

<script type="text/ng-template" id="/scripts/auth/dialog.html">
<div class="modal-dialog login-dialog">
  <div class="modal-dialog-title">
    <span class="modal-dialog-title-text">请登录以继续操作</span>
    <span class="modal-dialog-title-close"></span>
  </div>

  <div class="modal-dialog-content">
    <div class="login-form-wrapper">
      <a href="{{loginUrls.mail()}}" class="login-button btn-blue"><i class="icon icon-mail"></i>知乎帐号登录</a>
      <a href="javascript:;" ng-click="weiboLogin()" class="login-button btn-red"><i class="icon icon-weibo"></i>新浪微博登录</a>
    </div>
    <a href="http://www.zhihu.com/" class="signup">没有知乎帐号？现在注册 →</a>
  </div>
</div>
</script>

<script type="text/ng-template" id="/scripts/avatar/avatar-editor.html">
<div class="modal-dialog avatar-editor-dialog" ui-dialog="" tabindex="-1" open="show">
  <div class="modal-dialog-title">
    <span class="modal-dialog-title-text">头像裁剪</span>
    <span class="modal-dialog-title-close"></span>
  </div>

  <div class="modal-dialog-content"></div>

  <div class="modal-dialog-buttons">
    <button name="cancel">取消</button>
    <button name="yes" ng-click="submit($event)">确认</button>
  </div>
</div>
</script>

<script type="text/ng-template" id="/scripts/recommend/dialog-recommend.html">
<div class="modal-dialog" tabindex="-1">
    <div class="modal-dialog-title">
        <span class="modal-dialog-title-text">推荐到知乎日报</span>
        <span class="modal-dialog-title-close"></span>
    </div>

    <div class="modal-dialog-content share-dialog-content">
        <div class="share-dialog-section">
            {{title}}
        </div>
        <div class="share-dialog-section">
            <textarea class="share-dialog-textarea" placeholder="推荐理由、备注或其他（选填）" ng-model="reason" autofocus=""></textarea>
        </div>
    </div>

    <div class="modal-dialog-buttons">
        <button name="cancel">取消</button>
        <button name="yes" ng-click="submit()">推荐</button>
    </div>
</div>
</script>

<script type="text/ng-template" id="/scripts/report/dialog-report.html">
<div class="modal-dialog report-dialog" tabindex="-1">
  <div class="modal-dialog-title">
    <span class="modal-dialog-title-text">{{config.title}}</span>
    <span class="modal-dialog-title-close"></span>
  </div>

  <div class="modal-dialog-content">
    <form class="report-form" name="reportForm">
      <ul class="options clearfix">
        <li ng-repeat="code in config.reasons">
          <label><input ng-model="formData.reason" required="" value="{{code}}" name="reason" type="radio">{{Reasons[code]}}</label>
        </li>
      </ul>
      <p class="input-container" ng-show="formData.reason == '0'">
        <input ng-model="formData.detail" placeholder="举报理由" type="text" name="detail" class="reason-text basic-input" ng-minlength="2" ng-maxlength="100" ng-required="formData.reason == '0'">
      </p>
      <p class="error-container" ng-if="errorShow && reportForm.$invalid">
        <span ng-if="reportForm.reason.$invalid" class="error">请选择举报理由</span>
        <span ng-if="reportForm.detail.$invalid" class="error">举报理由为 2-100 字</span>
      </p>
      <p class="footnote"></p>
    </form>
  </div>

  <div class="modal-dialog-buttons">
    <button name="cancel">取消</button>
    <button name="yes" ng-click="submit($event)">确认</button>
  </div>
</div>
</script>

<script type="text/ng-template" id="/views/404.html">
<div class="server-error-container">
  <i class="icon icon-error-404"></i>
  没有找到该页面
</div>
</script>

<script type="text/ng-template" id="/views/500.html">
<div class="server-error-container">
  <i class="icon icon-error-500"></i>
  {{message || '抱歉，程序出了些问题'}}
</div>
</script>

<script type="text/ng-template" id="/views/column-authors-edit.html">
<div class="invite-authors setting-sec" ng-controller="ColumnAuthorsEditCtrl">
  <div class="form-title with-margin">邀请作者</div>
  <div class="form-content">

    <div class="invite-authors-wrapper">
      <i class="icon icon-magnify"></i>
      <input ui-suggest="" suggest-options="suggestOptions" class="basic-input" placeholder="搜索你想邀请的人">
    </div>

    <ul class="invited-list clearfix">
      <li class="author" ng-repeat="author in authors | filter:notMe | limitTo:100">
        <a href="{{author.profileUrl}}" class="author-link" target="_blank">
          <img class="avatar" ng-src="{{author.avatar | avatarUrl:25}}"><span class="name">{{author.name}}</span>
        </a>
        <a ng-click="removeAuthor(author)" href="javascript:;" class="remove" title="移除"><i class="icon icon-remove-link"></i></a>
      </li>
    </ul>

    <!-- <div class="list-title">尚未接受邀请：</div>

    <ul class="invited-but-not-in-list clearfix">
      <li class="author" ng-repeat="author in authors | filter:notMe | limitTo:100">
        <a href="{{author.profileUrl}}" class="author-link" target="_blank">
          <img class="avatar" ng-src="{{author.avatar | avatarUrl:25}}"></img><span class="name">{{author.name}}</span>
        </a>
        <a ng-click="removeAuthor(author)" href="javascript:;" class="remove" title="移除"><i class="icon icon-remove-link"></i></a>
      </li>
    </ul> -->


  </div>
</div>
</script>

<script type="text/ng-template" id="/views/column-create.html">
<div class="main receptacle column-settings" ng-switch="" on="betaStatus">
  <div ng-switch-when="available">
    <div ng-switch="" on="canCreateColumn">
      <div ng-switch-when="true">
        <div ng-include="'/views/column-edit.html'"></div>
      </div>
      <div class="server-error-container" ng-switch-when="false">
        <i class="icon icon-error-500"></i>
        <p>你好！目前专栏处于内测期<br>暂时仅提供一人开通一个专栏的服务，感谢你的理解：）</p>
      </div>
    </div>
  </div>
  <div class="server-error-container" ng-switch-when="unavailable">
    <i class="icon icon-error-500"></i>
    <p>你还没有收到专栏测试邀请，请耐心等待</p>
  </div>
  <div class="server-error-container" ng-switch-when="expired">
    <i class="icon icon-error-500"></i>
    <p>你收到的专栏测试邀请超过 90 天没有启用，已经失效<br>请耐心等待下一次邀请通知，非常感谢</p>
  </div>
</div>
</script>

<script type="text/ng-template" id="/views/column-edit.html">
<div class="column-form" ng-form="columnForm" novalidate="" ng-controller="ColumnEditCtrl">

  <!-- when there is no column -->
  <!--
  <div class="create-self-column setting-sec" style="display: none;">
    <img class="avatar" src="http://p1.zhimg.com/49/3b/493b133d5_l.jpg" alt="薛天禄">
    <a href="" class="create-self-column-btn">直接开通「薛天禄的专栏」<i class="icon icon-create-column-next"></i></a>
    <div class="devider">
      <span class="text">或自行填写资料</span>
    </div>
  </div> -->

  <div class="avatar-editing setting-sec">
    <div class="upload-controls fileinput-button" data-file-upload="fileuploadOptions" ng-class="{progressing: active()}">
      <div class="ui-progress centered fx-fade" ng-class="{'with-avatar': column.avatar.id}" ng-if="active()">
        <div class="bar" ng-style="{width: num + '%'}" data-file-upload-progress="progress()"></div>
      </div>

      <div ng-switch="" on="!!column.avatar.id">
        <!-- when there is no column avatar -->
        <div class="without-avatar" ng-switch-when="false">
          <div class="avatar-preview">
            <i class="icon icon-upload-avatar"></i>
            <div class="tip">上传专栏头像</div>
          </div>
        </div>
        <!-- when there is a column avatar -->
        <div class="with-avatar" ng-switch-when="true">
          <div class="avatar-preview">
            <img ng-src="{{column.avatar | avatarUrl:200}}" class="avatar">
          </div>
          <div class="upload">
            <span class="change-avatar">修改专栏头像</span>
          </div>
        </div>
      </div>

      <input type="file" accept="image/*" name="picture">
    </div>
  </div>

  <div class="basic-info setting-sec">
    <div class="form-title with-margin">专栏名</div>
    <div class="form-content">
      <div class="name">
        <input required="" ng-model="column.name" name="name" class="basic-input" placeholder="起个名字">
        <div class="error" ng-show="validatorEnabled && columnForm.name.$error.required">
          <i class="icon icon-error"></i>
          <span>必须填写专栏名</span>
        </div>
      </div>
    </div>
  </div>

  <div class="basic-info setting-sec">
    <div class="form-title with-margin">专栏主题</div>
    <div class="form-content">
      <div class="topics">
        <div class="topics-input" ui-tag-input="" ng-model="column.topics" name="topics" holdertext="搜索添加合适的专栏主题" min-tags="1" max-tags="3"></div>
        <div class="error" ng-show="validatorEnabled && columnForm.topics.$invalid">
          <i class="icon icon-error"></i>
          <span ng-if="columnForm.topics.$error.minTags">最少选择一个主题</span>
          <span ng-if="columnForm.topics.$error.maxTags">最多选择三个主题</span>
        </div>
      </div>
    </div>
  </div>

  <div class="desc setting-sec">
    <div class="form-title with-margin">简介</div>
    <div class="form-content input-container">
      <textarea ui-textarea-autogrow="" ng-model="column.description" class="basic-input" placeholder="写一段介绍（选填）"></textarea>
    </div>
  </div>

  <div class="url setting-sec">
    <div class="form-title with-margin">域名</div>
    <div class="form-content">
      <span class="url-spine">zhuanlan.zhihu.com/</span>
      <span class="input-container">
        <input required="" ng-model="column.slug" name="slug" class="basic-input" placeholder="填写自定义域名" ng-minlength="5" ng-pattern="/^[-a-zA-Z0-9]+$/" unique-column-slug="">
      </span>
      <div class="error" ng-show="validatorEnabled && columnForm.slug.$invalid">
        <i class="icon icon-error"></i>
        <span ng-if="columnForm.slug.$error.required">必须填写自定义域名</span>
        <span ng-if="columnForm.slug.$error.minlength">长度至少为五个字符</span>
        <span ng-if="columnForm.slug.$error.pattern">只能使用字母、数字和短横线</span>
        <span ng-if="columnForm.slug.$error.uniqueColumnSlug">此域名已经被占用</span>
      </div>
    </div>
  </div>

  <div class="comments setting-sec" id="permission">
    <div class="form-title">评论</div>
    <div class="form-content">
      <label class="radio-label">
        <input checked="checked" type="radio" name="permission" ng-model="column.commentPermission" value="anyone"> 所有人都能在专栏文章下评论
      </label>
      <label class="radio-label">
        <input type="radio" name="permission" ng-model="column.commentPermission" value="friends"> 只有作者关注的人能在其专栏文章下评论
      </label>
      <label class="radio-label">
        <input type="radio" name="permission" ng-model="column.commentPermission" value="none"> 关闭评论
      </label>
    </div>
  </div>

  <!-- <div class="binding setting-sec">
    <div class="form-title with-margin">账号连接</div>
    <div class="form-content">
      <button class="weibo btn-red"><i class="icon icon-weibo"></i>绑定新浪微博帐号</button>
      <button class="weixin btn-dark-green"><i class="icon icon-weixin"></i>绑定微信公共帐号</button>
    </div>
  </div> -->

  <!-- <div class="submission setting-sec">
    <div class="form-title">投稿</div>
    <div class="form-content">
      <label class="checkbox-label">
        <input ng-model="column.acceptSubmission" type="checkbox" class="submission">允许投稿<i></i>
      </label>
    </div>
  </div> -->

  <div class="create-column setting-sec" ng-switch="editMode">

    <div ng-switch-when="true">
      <div class="form-title">
        <button ui-confirm="remove(column)" confirm-message="你确定要删除这个专栏吗？" class="remove-button btn-link">删除专栏</button>
      </div>
      <button ng-disabled="validatorEnabled && !columnForm.$valid" class="btn-blue" ng-click="edit(column)">保存设置</button>
      <a href="/{{column.slug}}" class="cancel-button">取消</a>
    </div>

    <div ng-switch-when="false">
      <button ng-disabled="validatorEnabled && !columnForm.$valid" class="btn-blue" ng-click="create(column)">完成创建</button>
      <a href="javascript:" ng-click="back()" class="cancel-button">取消</a>
    </div>

  </div>
</div>
</script>

<script type="text/ng-template" id="/views/column-followers.html">
<div class="main receptacle column-followers-main">

  <h2 class="pape-title">{{column.followersCount}} 人关注该专栏</h2>

  <div ui-infinite="" data-source="source">

    <p class="items-empty" ng-show="!source.pending && !followers.length">
      <i class="icon" ng-class="{true: 'icon-error-500', false: 'icon-no-article'}[source.error]"></i>
      {{source.error && '抱歉，程序出了些问题' || '还没有关注者'}}
    </p>

    <ul class="column-followers clearfix">
      <li class="follower" ng-repeat="user in followers">
        <a href="{{user.profileUrl}}" target="_blank">
          <img class="avatar avatar-mid" ng-src="{{user.avatar | avatarUrl:50}}" alt="">
          <strong>{{user.name}}</strong>
          <span class="bio">{{user.bio}}</span>
        </a>
      </li>
    </ul>

  </div>

</div>
</script>

<script type="text/ng-template" id="/views/column-settings-authors.html">
<div class="main receptacle column-settings">

  <div class="tabs">
    <div class="tabs-nav clearfix">
      <a href="{{column.url}}/settings" class="tabs-anchor">设置</a>
      <span class="tabs-anchor active">作者</span>
    </div>
    <div>
      <div ng-include="'/views/column-authors-edit.html'"></div>
    </div>
  </div>

</div>
</script>

<script type="text/ng-template" id="/views/column-settings.html">
<div class="main receptacle column-settings">

  <div class="tabs">
    <div class="tabs-nav clearfix">
      <span class="tabs-anchor active">设置</span>
      <a href="{{column.url}}/settings/authors" class="tabs-anchor">作者</a>
    </div>
    <div>
      <div ng-include="'/views/column-edit.html'"></div>
    </div>
  </div>

</div>
</script>

<script type="text/ng-template" id="/views/columns-selector.html">
<div class="modal-dialog columns-selector" ui-dialog="" tabindex="-1" open="show">
  <div class="modal-dialog-title">
    <span class="modal-dialog-title-text">{{title}}</span>
    <span class="modal-dialog-title-close"></span>
  </div>

  <div class="modal-dialog-content">
    <div class="column-list" ng-show="columns.length">
        <a href="/{{column.slug}}" ng-click="select(column, $event)" class="column-item clearfix" ng-repeat="column in columns">
          <img class="avatar" ng-src="{{column.avatar | avatarUrl:50}}">
          <div class="column-content">
            <div class="column-title ellipsis">{{column.name}}</div>
            <div class="article-count">{{column.postsCount || 0}} 篇文章</div>
          </div>
          <i class="icon icon-go"></i>
        </a>
        <a href="javascript:;" ng-click="create()" class="column-item create-column" ng-if="mode != 'selectonly'">
          <i class="icon icon-create-column"></i>
          <div class="text">创建专栏</div>
          <i class="icon icon-go"></i>
        </a>
    </div>
  </div>
</div>
</script>

<script type="text/ng-template" id="/views/draft-list.html">
<div class="main receptacle">
  <div class="items-container" ui-infinite="" data-source="draftsSource">
    <h2 class="pape-title ng-binding" ng-show="draftsSource.count">
      <a href="javascript:;" ui-confirm="removeAllDrafts()" confirm-message="你确认要删除全部草稿吗？" class="delete-draft">删除全部</a>
      <span class="counter">{{draftsSource.count}} 篇草稿</span>
    </h2>
    <p class="items-empty" ng-if="!animating && !draftsSource.pending && !drafts.length">
      <i class="icon" ng-class="{true: 'icon-error-500', false: 'icon-no-article'}[draftsSource.error]"></i>
      {{draftsSource.error && '抱歉，程序出了些问题' || '还没有任何草稿'}}
    </p>
    <ul class="items draft-list" ng-show="drafts.length">
      <li class="item fx-draft-item-fade" ng-repeat="draft in drafts">
        <article class="hentry">
          <header>
            <h1 class="entry-title"><a href="/drafts/{{draft.id}}">{{draft.title || '无标题'}}</a></h1>
            <div class="entry-meta">
              <a href="/{{draft.column.slug}}" ng-if="draft.column.name" class="author name">{{draft.column.name}}</a>
              <span class="bull" ng-if="draft.column.name">·</span>
              <time ui-time="" datetime="{{draft.updatedTime}}" class="updated"></time>
              <span class="bull" ng-if="draft.state == 'censoring'">·</span>
              <span class="censoring" ng-if="draft.state == 'censoring'">审核中</span>
              <a href="javascript:;" class="delete" title="删除草稿" ui-confirm="removeDraft(draft, $index)" confirm-message="你确定要删除这篇草稿吗？">
                <i class="icon icon-del"></i>
              </a>
            </div>
          </header>
          <!-- <section class="entry-summary" ng-bind-html="draft.summary"></section> -->
          <section class="entry-summary">
            <a href="/drafts/{{draft.id}}">
              {{draft.content | truncateHtml}}
            </a>
          </section>
        </article>
      </li>
    </ul>

    <div class="posts-end" ng-show="drafts.length && draftsSource.completed"><i class="icon icon-posts-end"></i></div>
  </div>
</div>
</script>

<script type="text/ng-template" id="/views/home.html">
<div class="top">
	<div class="logo hide-text">知乎 - 无需提问，也能回答</div>
</div>
<div class="bottom">
	<div class="teaser hide-text">新功能即将推出</div>
</div>
</script>

<script type="text/ng-template" id="/views/ie.html">
<div class="server-error-container">
  <i class="icon icon-error-500"></i>
  抱歉，暂不支持低版本 Internet Explorer 网页浏览器，请升级：
  <ul style="text-align:center;list-style:none">
    <li>
      <a target="_blank" href="https://www.google.com/chrome">Google Chrome</a>
    </li>
    <li>
      <a target="_blank" href="http://se.360.cn">360安全浏览器</a>
    </li>
    <li>
      <a target="_blank" href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie">Internet Explorer 10</a>
    </li>
  </ul>
</div>
</script>

<script type="text/ng-template" id="/views/main.html">
<div class="main receptacle home-view">

  <div class="rec-section posts">
    <h1 class="rec-title">推荐文章</h1>
    <p class="items-empty" ng-show="!loading && !posts.length">
      还没有任何文章
    </p>
    <ul class="items" ng-show="posts.length">
      <li class="item" ng-repeat="post in posts">
        <article class="hentry" ng-controller="EntryCtrl">
          <header>
            <a ng-click="toggleLike(post)" href="javascript:;" class="vote-num">{{post.likesCount}}</a>
            <h2 class="entry-title"><a href="/{{post.column.slug}}/{{post.slug}}">{{post.title}}</a></h2>
            <div class="entry-meta">
              <a href="{{post.author.profileUrl}}" class="author name">{{post.author.name}}</a>
              <span class="bull">·</span>
              <time ui-time="" datetime="{{post.publishedTime}}" class="published"></time>
              <a href="/{{post.column.slug}}/{{post.slug}}#comments" class="comment"><i class="icon icon-comment"></i>{{post.commentsCount && (post.commentsCount + ' 条评论') || '还没有评论'}}</a>
            </div>
          </header>

          <section class="entry-summary">{{post.content | truncateHtml}}</section>
        </article>
      </li>
    </ul>
  </div>

  <aside class="sidebar">
    <div class="rec-section columns">
      <h2 class="rec-title">推荐专栏</h2>
      <div class="block author-block" ng-repeat="column in columns">
        <a href="{{column.slug}}" class="link column">
          <img class="avatar" ng-src="{{column.image}}">
          <span class="name">{{column.name}}</span>
        </a>
        <div class="desc">{{column.description}}</div>
      </div>
    </div>
  </aside>

</div>
</script>

<script type="text/ng-template" id="/views/maintenance.html">
<div class="server-error-container">
  <i class="icon icon-error-404"></i>
  抱歉，正在抢修程序中
</div>
</script>

<script type="text/ng-template" id="/views/navbar.html">
<header id="header" class="navbar" ng-controller="NavbarCtrl" ng-cloak="">
  <div class="receptacle">

    <div class="navbar-logo-container">
      <a href="//www.zhihu.com" target="_blank" class="logo icon icon-navbar-logo"></a>
    </div>

    <a href="javascript:;" class="navbar-login" ng-click="showLoginDialog()" ng-if="!me.authed() && me.$resolved">
      <i class="icon icon-navbar-login"></i>
      登录
    </a>

    <div class="navbar-menu-container" ui-menu-button="" ng-if="me.authed() && !me.beta">
      <a href="javascript:;" class="menu-button">
        <i class="icon icon-navbar-menu"></i><span class="hide-text">菜单</span>
      </a>
      <menu class="menu navbar-menu">
        <a class="menu-item dd-logout" href="//www.zhihu.com/logout">
          <i class="icon icon-dd-logout"></i>退出帐号</a>
      </menu>
    </div>

    <div class="navbar-menu-container" ui-menu-button="" ng-if="me.beta">
      <a href="javascript:;" class="menu-button">
        <i class="icon icon-navbar-menu"></i><span class="hide-text">菜单</span>
      </a>
      <menu class="menu navbar-menu">
        <a class="menu-item my-column" href="{{column.url}}" ng-repeat="column in me.columns | limitTo:minColumnsDisplay">
          <img class="avatar" ng-src="{{column.avatar | avatarUrl:25}}">{{column.name}}</a>
        <a class="menu-item dd-my-columns" href="javascript:;" ng-click="showNavColumnsSelector()" ng-if="me.columns.length > minColumnsDisplay">
          <i class="icon icon-dd-columns"></i>全部专栏</a>
        <a class="menu-item dd-create-column" href="/create" ng-if="me.columns.length < maxColumn">
          <i class="icon icon-dd-create"></i>创建专栏</a>
        <a class="menu-item dd-logout" href="//www.zhihu.com/logout">
          <i class="icon icon-dd-logout"></i>退出帐号</a>
      </menu>
    </div>

    <div class="navbar-drafts-container" ng-if="me.beta">
      <a href="/drafts">
        <i class="icon icon-navbar-drafts"></i><span class="hide-text">我的草稿</span>
      </a>
    </div>

    <div class="navbar-write-container" ng-if="me.beta">
      <a href="{{ me.columns.length ? '/write' : '/create'}}" ng-click="column.canPost && writePostFor(column)">
        <i class="icon icon-navbar-write"></i><span class="hide-text">创作</span>
      </a>
    </div>

    <div class="navbar-content">
      <ul class="breadcrumb clearfix">
        <li class="breadcrumb-item column-name" ng-if="column && column.name && !columnSelectOnly">
          <a class="link" href="/{{column.slug}}">
            <button ng-click="toggleFollow(column, $event)" class="btn normal" ng-class="{ true: 'btn-grey', false: 'btn-dark-green' }[column.following]" ng-if="me.slug != column.creator.slug">{{column.following && '取消关注' || '关注专栏'}}</button>
            <span class="name" title="{{column.name}}">{{column.name}}</span>
          </a>
        </li>
        <li class="breadcrumb-item" ng-if="columnSelectOnly">
          <a class="link column-selector" href="/{{selectedColumn.slug}}" ng-click="selectColumn(selectedColumn, $event)">
            <span class="name" ng-class="{'warn': !selectedColumn.name}">{{selectedColumn.name || '尚未选择专栏'}}</span>
            <i class="icon icon-navbar-select"></i>
          </a>
        </li>
        <li class="breadcrumb-devider" ng-if="column && pageTitle || columnSelectOnly"></li>
        <li class="breadcrumb-item">
          <span class="name" ng-bind="pageTitle"></span>
        </li>
      </ul>
    </div>

  </div>
</header>
</script>

<script type="text/ng-template" id="/views/post-comments.html">
<div class="comment-box" ng-show="expanded" ng-class="{ empty: !pending && !comments.length }" ng-switch="pending" ng-init="warningMessageShow = !status.canComment && status.permission != 'anyone'">

  <div class="box-header">
    <span class="counter">
      <i class="icon icon-comment"></i><span>{{status.count && (status.count + ' 条评论') || '还没有评论'}}</span>
    </span>
    <a href="{{$parent.column.url}}/settings#permission" class="comment-options" ng-show="$parent.column.creator.slug == me.slug" title="评论设置">
      <i class="icon icon-settings"></i>
    </a>
  </div>

  <span ng-switch-when="true"><div ui-spinner="" class="small"></div></span>

  <div ng-switch-when="false">

    <ul class="comment-list">
      <li class="comment-item" ng-repeat="comment in comments | orderBy:'id' track by comment.id" id="comment-{{comment.id}}" ui-events="{focusin: 'focusin = true', focusout: 'focusin = false'}" ng-class="{focusin:focusin}">

        <a ui-hovercard="" target="_blank" class="avatar-link" title="{{comment.author.name}}" href="{{comment.author.profileUrl}}" tabindex="-1">
          <img ng-src="{{comment.author.avatar | avatarUrl:50}}" class="avatar">
        </a>

        <div class="comment-body" ng-init="reply = {content: '', hidden: true}">
          <div class="comment-hd">
            <a href="{{comment.author.profileUrl}}" target="_blank">{{comment.author.name}}</a><span ng-if="isPostOwner(comment.author)">（作者）</span>
            <span class="in-reply-to" ng-show="comment.inReplyToUser">
              回复 <a href="{{comment.inReplyToUser.profileUrl}}">{{comment.inReplyToUser.name}}</a><span ng-if="isPostOwner(comment.inReplyToUser)">（作者）</span>
            </span>
          </div>

          <div class="comment-content" ng-bind-html="comment.content"></div>

          <div class="comment-ft clearfix">
            <time ui-time="" datetime="{{comment.createdTime}}" class="date"></time>

            <span class="like-num {{comment.likesCount && 'liked' || 'nil'}}" title="{{comment.likesCount}} 人觉得这个很赞"><span>{{comment.likesCount}}</span> <span>赞</span></span>

            <a ng-if="canRemove(comment)" ng-click="remove(comment)" href="javascript:;" class="remove op-link"><i class="icon icon-comment-remove"></i>删除</a>

            <a ng-if="canReply(comment)" ng-click="toggleReplyForm(reply)" href="javascript:;" class="reply op-link"><i class="icon icon-comment-reply"></i>回复</a>

            <a ng-if="!ownComment(comment)" ng-click="like(comment)" href="javascript:;" class="like op-link {{comment.liked && 'liked' || ''}}"><i class="icon icon-comment-like"></i>{{comment.liked && '取消赞' || '赞'}}</a>

            <a ng-if="!ownComment(comment)" ng-click="report(comment)" href="javascript:;" class="report op-link"><i class="icon icon-comment-report"></i>举报</a>

          </div>

          <form name="replyForm" class="comment-form comment-reply-form expanded hidden" ng-if="canReply(comment)" ng-class="{hidden: reply.hidden}">
            <img class="avatar" ng-src="{{me.avatar | avatarUrl:50}}">
            <div class="editable" ui-focus-me="!reply.hidden" ui-ctrl-enter="replyComment(comment, reply, replyForm)" ui-scraper="" scraper-options="scraperOptions" ui-mention="" ui-clean-paste="" contenteditable="true" content-required="" ng-model="reply.content" holdertext="写下你的评论…"></div>
            <div class="command clearfix" ng-if="me.authed()">
              <button ng-disabled="reply.pending || !reply.content" ng-click="replyComment(comment, reply, replyForm)" class="save btn-blue">评论</button>
              <button ng-click="reply.hidden = true" class="cancel btn-link">取消</button>
            </div>
          </form>

        </div>
      </li>
    </ul>

    <div class="load-more" ng-if="!source.completed" ng-switch="" on="source.pending">
      <a ng-switch-when="false" href="javascript:;" ng-click="source.fetch()">显示更多评论</a>
      <span ng-switch-when="true"><div ui-spinner="" class="small"></div></span>
    </div>

    <div class="message" ng-if="warningMessageShow" ng-switch="status.permission">
      <span ng-switch-when="denied">对方已将你屏蔽，你无法在这里评论</span>
      <span ng-switch-when="friends">只有作者关注的人才能在这里评论</span>
      <span ng-switch-when="none">评论已关闭</span>
    </div>

    <form class="comment-form comment-box-ft" ng-class="{ 'expanded': formExpanded }" name="commentForm" ng-if="!warningMessageShow">
      <img class="avatar" ng-src="{{me.avatar | avatarUrl:50}}" ng-if="me.authed()">
      <div class="editable" ui-scraper="" scraper-options="scraperOptions" ui-mention="" ui-clean-paste="" ui-events="{focus:'expandForm(true)'}" ui-ctrl-enter="addComment()" contenteditable="true" content-required="" ng-model="editingComment.content" holdertext="写下你的评论…" name="content"></div>
      <div class="command clearfix" ng-if="me.authed()">
        <button ng-disabled="savePending" ng-click="addComment()" class="save btn-blue">评论</button>
        <button ng-click="expandForm(false, $event)" class="cancel btn-link">取消</button>
      </div>
    </form>

  </div>

</div>
</script>

<script type="text/ng-template" id="/views/post-list.html">
<div class="column-actions" ng-if="!column.canPost && column.activateAuthorRequested">
  <div class="receptacle clearfix">
    <a class="action-link invite" ng-click="activateAuthor(column)" href="javascript:;">
      <i class="icon icon-panel-invite"></i>您被邀请成为作者，点此接受
    </a>
  </div>
</div>

<div class="main receptacle">
  <div class="items-container" ui-infinite="" data-source="postsSource">
    <p class="items-empty" ng-show="!postsSource.pending && !posts.length">
      <i class="icon" ng-class="{true: 'icon-error-500', false: 'icon-no-article'}[postsSource.error]"></i>
      {{postsSource.error && '抱歉，程序出了些问题' || '尚未发布过文章'}}
    </p>

    <ul class="items" ng-show="posts.length">
      <li class="item" ng-repeat="post in posts" ng-class="{'item-with-title-img': titleImageShow}" ng-init="titleImageShow = post.titleImage && supportsBackgroundSize">
        <article class="hentry" ng-controller="EntryCtrl" ui-in-view="" oninviewonce="post.touch()">
          <header>

            <div ng-if="post.sourceUrl" class="linked-post-link-wrapper">
              <a class="link" href="{{post.sourceUrl}}" target="_blank">
                <i class="icon icon-linked-post"></i>{{post.sourceUrl | linkDomain}}
              </a>
            </div>

            <a href="/{{post.column.slug}}/{{post.slug}}" href="javascript:;" class="vote-num" ng-show="post.likesCount"><i class="icon icon-voteup"></i>{{post.likesCount}}<span class="hide-on-mobile"> 赞</span></a>

            <h1 class="entry-title">
              <a href="/{{post.column.slug}}/{{post.slug}}">{{post.title}}</a>
            </h1>

            <div class="entry-meta">
              <a target="_blank" href="{{post.author.profileUrl}}" class="author name">{{post.author.name}}</a>
              <span class="bull" ng-click="test()">·</span>
              <time ui-time="" datetime="{{post.publishedTime}}" class="published"></time>
              <a href="/{{post.column.slug}}/{{post.slug}}#comments" class="comment" ng-show="post.commentsCount"><i class="icon icon-comment"></i>{{post.commentsCount}}<span class="hide-on-mobile"> 条评论</span></a>
            </div>

            <a href="/{{post.column.slug}}/{{post.slug}}" class="entry-link" ng-if="titleImageShow"></a>
            <div class="title-img-preview" ng-style="{'background-image': 'url(' + post.titleImage + ')' || {}}" ng-if="titleImageShow"></div>
            <div ui-spinner="" ng-if="titleImageShow"></div>
          </header>

          <section class="entry-summary" ng-if="!titleImageShow">
            <a href="/{{post.column.slug}}/{{post.slug}}">
              <p ui-summary="post.content">
                <span class="read-all">继续阅读<i class="icon icon-read-all"></i></span>
              </p>
            </a>
          </section>
        </article>
      </li>
    </ul>

    <div class="posts-end" ng-show="posts.length && postsSource.completed"><i class="icon icon-posts-end"></i></div>
  </div>

  <aside class="sidebar">

    <div class="block column-about">
      <div class="avatar-link">
        <img class="avatar-big" ng-src="{{column.avatar | avatarUrl:100}}">
      </div>
      <div href="/{{column.slug}}" class="title">{{column.name}}</div>
      <a class="btn-white mid" ng-if="column.creator.slug == me.slug" href="/{{column.slug}}/settings"><i class="icon icon-settings"></i>设置</a>
      <div class="followers" ng-switch="" on="!!column.followersCount">
        <a ng-switch-when="true" href="/{{column.slug}}/followers">{{column.followersCount}} 人关注</a>
        <span ng-switch-when="false">还没有人关注</span>
      </div>
      <div class="description" ng-bind-html="column.description | linky"></div>
    </div>

  </aside>

</div>
</script>

<script type="text/ng-template" id="/views/post-view.html">
<div class="main receptacle post-view">

  <article class="entry" ng-controller="EntryCtrl" ui-lightbox="">
    <header>
      <div class="entry-title-image" ng-if="post.titleImage">
        <!-- <span class="img-captions">我的摄影作品</span> -->
        <img ng-src="{{post.titleImage}}">
      </div>

      <div ng-if="post.sourceUrl" class="linked-post-link-wrapper">
        <a class="link" href="{{post.sourceUrl}}" target="_blank">
          <i class="icon icon-linked-post"></i>{{post.sourceUrl | linkDomain}}
        </a>
      </div>

      <h1 class="entry-title">{{post.title}}</h1>

      <div class="entry-meta">
        <a target="_blank" href="{{post.author.profileUrl}}" class="author name">
          <img ng-src="{{post.author.avatar | avatarUrl:25}}" alt="{{author.name}}" class="avatar-small">{{post.author.name}}</a>
        <span class="bull">·</span>
        <time ui-time="" datetime="{{post.publishedTime}}" class="published"></time>
      </div>
    </header>

    <div class="entry-warning" ng-if="isCensoring" ng-class="{'with-arrow': ownPost(post)}">
      <div>
        <a href="http://www.zhihu.com/question/24752645" target="_blank" class="pull-right icon-help"></a>
        {{post.stateText}}
      </div>
      <div class="text-muted" ng-switch="ownPost(post)">
        <span ng-switch-when="true">建议修改期间，文章内容对其他用户不可见。修改提交后会自动进入评估状态。</span>
        <span ng-switch-when="false">作者修改内容通过后，文章会重新显示。</span>
      </div>
    </div>

    <section class="entry-content" ng-bind-html="postContentTrustedHtml"></section>

    <footer>
      <div class="entry-controls clearfix">
        <div class="right-section">
          <!-- <span class="control-item read-counts">
            <i class="icon icon-eye"></i>13 人读过
          </span> -->
          <span class="post-share-button post-menu-button" ui-menu-button="" onbeforeopen="beforeShareMenuOpen()" ng-if="!isCensoring">
            <a href="javascript:;" class="menu-button control-item share"><i class="icon icon-share"></i>分享</a>
            <menu class="menu">
              <div ng-click="item.action()" class="menu-item" ng-repeat="item in shareMenuItems">
                <i class="icon {{item.icon}}"></i>{{item.label}}
              </div>
            </menu>
          </span>

          <a href="{{post.url}}/edit" class="control-item post-edit-button" ng-if="ownPost(post)">
            <i class="icon icon-edit"></i>编辑
          </a>

          <span class="post-options-button post-menu-button" ng-show="ownPost(post)" ui-menu-button="">
            <a href="javascript:;" class="menu-button control-item options">
              <i class="icon icon-settings"></i><span class="hide-text">设置</span>
            </a>
            <menu class="menu">
              <div ng-click="removePost()" class="menu-item"><i class="icon icon-del-big"></i>删除</div>
            </menu>
          </span>

          <a ng-if="!ownPost(post) && !isCensoring" ng-click="report(post)" href="javascript:;" class="control-item report"><i class="icon icon-comment-report"></i>举报</a>

        </div>

        <div class="left-section" ng-if="!isCensoring">
          <div class="vote-section-wrapper clearfix">
            <span class="vote-section" ng-show="!ownPost(post)">
              <a ng-click="post.toggleLike()" href="javascript:;" class="voteup" ng-class="{ active: post.rating == 'like' }"><i class="icon icon-voteup"></i>{{post.likesCount && (post.likesCount + ' 赞') || '赞'}}</a>
              <a ng-click="post.toggleDislike()" href="javascript:;" class="votedown" ng-class="{ active: post.rating == 'dislike' }"><i class="icon icon-votedown"></i></a>
            </span>
            <span class="vote-num" ng-show="ownPost(post)">{{post.likesCount && (post.likesCount + ' 赞') || '还没有赞'}}</span>
          </div>

          <div class="voters clearfix" ng-if="post.lastestLikers.length && !likers">
            <a href="{{user.profileUrl}}" target="_blank" title="{{user.name}}" class="voter" ng-repeat="user in post.lastestLikers">
              <img ng-src="{{user.avatar | avatarUrl:25}}" alt="{{user.name}}" class="avatar-small">
            </a>
            <a href="javascript:;" title="查看全部" class="more-voters" ng-click="fetchAllLikers()" ng-if="post.lastestLikers.length < post.likesCount && !fetchLikersPending">
              <i class="icon icon-more-voters"></i>
            </a>
            <a class="more-voters" ng-if="fetchLikersPending">
              <div ui-spinner="" class="half"></div>
            </a>
          </div>

          <div class="voters clearfix" ng-if="likers">
            <a href="{{user.profileUrl}}" target="_blank" title="{{user.name}}" class="voter" ng-repeat="user in likers">
              <img ng-src="{{user.avatar | avatarUrl:25}}" alt="{{user.name}}" class="avatar-small">
            </a>
          </div>
        </div>

      </div>

      <!-- <a ng-click="collect(post)" href="javascript:;" class="collect"><i class="icon icon-collect"></i>收藏</a> -->

      <div class="posts-navigator" ng-if="post.meta.previous || post.meta.next">
        <div class="posts-nav" ng-class="{one: !post.meta.previous || !post.meta.next}">
          <a class="prev post-link" href="{{post.meta.previous.url}}" ng-show="post.meta.previous">
            <i class="icon icon-prev-post"></i>
            <strong class="title">{{post.meta.previous.title}}</strong>
          </a>
          <a class="next post-link" href="{{post.meta.next.url}}" ng-show="post.meta.next">
            <i class="icon icon-next-post"></i>
            <strong class="title">{{post.meta.next.title}}</strong>
          </a>
        </div>
      </div>

      <div id="comments" class="entry-comments" ui-post-comments="" comments-href="post.links.comments" comments-expanded="true" comments-post-owner="post.author" comments-status="commentsStatus" ng-if="!isCensoring"></div>
    </footer>
  </article>

  <aside class="sidebar">

    <div class="block column-about">
      <a href="/{{column.slug}}" class="avatar-link">
        <img class="avatar-big" ng-src="{{column.avatar | avatarUrl:100}}">
      </a>
      <a href="/{{column.slug}}" class="title">{{column.name}}</a>
      <a class="btn-white mid" ng-if="column.creator.slug == me.slug" href="/{{column.slug}}/settings"><i class="icon icon-settings"></i>设置</a>
      <div class="followers" ng-switch="" on="!!column.followersCount">
        <a ng-switch-when="true" href="/{{column.slug}}/followers">{{column.followersCount}} 人关注</a>
        <span ng-switch-when="false">还没有人关注</span>
      </div>
      <div class="description" ng-bind-html="column.description | linky"></div>
    </div>

    <div class="block rel-topics" ng-show="!isCensoring && (post.topics.length || ownPost(post))">
      <ul class="clearfix" ng-if="post.topics.length">
        <li class="topic" ng-repeat="topic in post.topics" ng-class="{ canedit: ownPost(post) }">
          <span class="topic-inner-wrapper">
            <a href="{{topic.url}}" class="topic-link">{{topic.name}}</a>
            <a ng-click="unbindTopic(topic, $index)" class="remove-topic" ng-show="ownPost(post)"><i class="icon icon-remove-topic"></i></a>
          </span>
        </li>
      </ul>
      <div class="add-topic" ng-if="ownPost(post)">
        <i class="icon icon-magnify"></i>
        <input ui-suggest="" suggest-options="suggestOptions" placeholder="添加话题">
      </div>
    </div>

  </aside>

</div>
</script>

<script type="text/ng-template" id="/views/post-write.html">
<div class="main post-write" ng-form="postForm">
  <section class="receptacle">

  <div id="js-title-img" class="title-img" ui-droppable="">
    <span ng-if="!draft.titleImage" class="hover-tip">添加题图（可选）</span>

    <div class="upload-controls" data-file-upload="fileuploadOptions">
      <div class="preview-wrapper fileinput-button" ng-show="!active()">
        <i ng-if="!draft.titleImage" class="icon icon-add-titleimg"></i>
        <img ng-show="draft.titleImage" class="preview" ng-src="{{draft.titleImage}}">
        <input type="file" accept="image/*" name="upload_file" id="js-title-img-input">
      </div>

      <div class="ui-progress centered" ng-if="active()">
        <div class="bar" ng-style="{width: num + '%'}" data-file-upload-progress="progress()"></div>
      </div>

      <div class="img-edit-options" ng-show="!active() && draft.titleImage">
        <!-- <a class="caption">
          <i class="icon icon-img-caption"></i>
          <span class="hidden">注解</span>
          <input type="text" class="caption-input" placeholder="注解">

          <input type="text" class="caption-input with-content" placeholder="注解" value="我的摄影作品">
        </a> -->
        <button class="action-button change fileinput-button" onclick="angular.element('#js-title-img-input').click()">
          <i class="icon icon-img-change"></i>
          <span class="hidden">更换</span>
        </button>
        <button class="action-button delete" ui-confirm="draft.titleImage=''" confirm-message="你确定要删除这张题图吗？">
          <i class="icon icon-img-delete"></i>
          <span class="hidden">删除</span>
        </button>
      </div>
    </div>
  </div>
  <div id="js-editor-toolbar" class="toolbar-holder" ui-sticky="" data-align="bottom" data-target="#js-title-img"></div>

  <div class="title-input-container" ng-init="titleScraping = false">
    <div class="title-scraper-preview linked-post-link-wrapper" ng-show="titleScraping || draft.sourceUrl">
      <a href="{{draft.sourceUrl}}" target="_blank" class="link" ng-show="draft.sourceUrl">
        <i class="icon icon-linked-post"></i>{{draft.sourceUrl}}
      </a>
      <a class="remove-button" title="删除" ng-click="draft.sourceUrl = ''" ng-show="draft.sourceUrl">
        <i class="icon icon-remove-link"></i>
      </a>
      <i ui-spinner="" class="small" ng-show="titleScraping"></i>
    </div>
    <textarea ui-textarea-autogrow="" required="" ng-model="draft.title" name="title" class="title" placeholder="标题" ui-title-scraper="" ng-disabled="titleScraping" onscrapesuccess="draft.sourceUrl = link.url" onscrapestart="titleScraping = true" onscrapeend="titleScraping = false" ui-tab-trigger="" autofocus=""></textarea>
  </div>

  </section>

  <div class="editable-container">
    <div id="js-entry-content" class="entry-content editable" ng-model="draft.content" name="content" contenteditable="true" holdertext="正文" content-required="" ui-clean-paste="" ui-scraper="" ui-mention="" ui-events="{input:'onContentChange($event)'}" ui-editor="" editor-toolbar="js-editor-toolbar"></div>
    <div ui-popover="" popover-options="{container:'#js-entry-content', selector: 'img:not([eeimg])'}">
      <div class="img-edit-options">
        <button class="action-button delete" ui-confirm="removeAnchor()" confirm-message="你确定要删除这张图片吗？">
          <i class="icon icon-img-delete"></i>
          <span class="hidden">删除</span>
        </button>
      </div>
    </div>
  </div>

</div>

<div class="publish-section right-bottom-corner">
  <span class="draft-control">
    <button class="btn-link" ui-confirm="removeDraft(draft)" title="删除草稿" confirm-message="你确定要删除这篇草稿吗？" ng-show="draft.id"><i class="icon icon-del-big"></i></button>
    <span class="hint error" ng-show="errorHint">{{ errorHint }}</span>
    <span class="hint" ng-show="!errorHint">{{ (draftSaving || draftCreating) && '保存中...' || '已保存' }}</span>
  </span>
  <button ng-click="back()" class="cancel-publish btn-hollow">关闭</button>
  <button ng-click="publish()" class="publish btn-blue">{{ (draft.state == 'censoring') && '修改' || '发布' }}</button>
</div>

<div ui-columns-selector="" data-show="columnsSelectorShow" data-href="me.links.columns" data-title="选择专栏" onselect="selectColumn(column)"></div>
</script>
<!-- End Templates -->


<div></div><style>html.lightbox-zoomin body {padding-right: 17px;}</style></body></html>